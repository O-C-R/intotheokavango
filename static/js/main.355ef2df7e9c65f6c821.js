webpackJsonp([1],{0:function(module,exports,__webpack_require__){module.exports=__webpack_require__(481)},80:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_luma=__webpack_require__(65),_util=__webpack_require__(475),_log=__webpack_require__(249),_log2=_interopRequireDefault(_log),_lodash=__webpack_require__(738),_lodash2=_interopRequireDefault(_lodash),_assert=__webpack_require__(5),_assert2=_interopRequireDefault(_assert),_viewportMercatorProject=__webpack_require__(79),_viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject),DEFAULT_PROPS={key:0,opacity:.8,numInstances:void 0,data:[],isPickable:!1,deepCompare:!1,getValue:function(x){return x},onHover:function(){},onClick:function(){},updateTriggers:{}},ATTRIBUTES={instancePickingColors:{size:3,0:"pickRed",1:"pickGreen",2:"pickBlue"}},counter=0,Layer=function(){function Layer(props){_classCallCheck(this,Layer),props=_extends({},DEFAULT_PROPS,props),props.data&&((0,_util.addIterator)(props.data),(0,_assert2["default"])(props.data[Symbol.iterator],"data prop must have an iterator")),this.props=props,this.checkProp(props.data,"data"),this.checkProp(props.id,"id"),this.checkProp(props.width,"width"),this.checkProp(props.height,"height"),this.checkProp(props.width,"width"),this.checkProp(props.height,"height"),this.checkProp(props.latitude,"latitude"),this.checkProp(props.longitude,"longitude"),this.checkProp(props.zoom,"zoom"),this.count=counter++}return _createClass(Layer,null,[{key:"attributes",get:function(){return ATTRIBUTES}}]),_createClass(Layer,[{key:"initializeState",value:function(){}},{key:"didMount",value:function(){}},{key:"shouldUpdate",value:function(oldProps,newProps){if(this.checkUpdateTriggers(oldProps,newProps))return!0;var equalShallow=(0,_util.areEqualShallow)(newProps,oldProps,{ignore:{updateTriggers:!0}});return equalShallow?!(!newProps.deepCompare||(0,_lodash2["default"])(newProps.data,oldProps.data))&&(this.setState({dataChanged:!0}),!0):(newProps.data!==oldProps.data&&this.setState({dataChanged:!0}),!0)}},{key:"willReceiveProps",value:function(oldProps,newProps){var attributeManager=this.state.attributeManager;this.state.dataChanged&&attributeManager.invalidateAll()}},{key:"willUnmount",value:function(){}},{key:"setNeedsRedraw",value:function(){var redraw=arguments.length<=0||void 0===arguments[0]||arguments[0];this.state&&(this.state.needsRedraw=redraw)}},{key:"getNeedsRedraw",value:function(){var _ref=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],_ref$clearRedrawFlags=_ref.clearRedrawFlags,clearRedrawFlags=void 0!==_ref$clearRedrawFlags&&_ref$clearRedrawFlags;if(!this.state)return!1;var _state=this.state,attributeManager=_state.attributeManager,model=_state.model,redraw=!1;return redraw=redraw||this.state.needsRedraw,this.state.needsRedraw=this.state.needsRedraw&&!clearRedrawFlags,redraw=redraw||attributeManager.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags}),redraw=redraw||model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags})}},{key:"setState",value:function(updateObject){Object.assign(this.state,updateObject),this.state.needsRedraw=!0}},{key:"setUniforms",value:function(uniformMap){this.state.model&&this.state.model.setUniforms(uniformMap),this.state.needsRedraw=!0,(0,_log2["default"])(3,"layer.setUniforms",uniformMap)}},{key:"getFirstObject",value:function(){var data=this.props.data,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var object=_step.value;return object}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return null}},{key:"getNumInstances",value:function(props){if(props=props||this.props,this.state&&void 0!==this.state.numInstances)return this.state.numInstances;if(void 0!==props.numInstances)return props.numInstances;var _props=props,data=_props.data;if(data&&"function"==typeof data.count)return data.count();if(data&&void 0!==data.size)return data.size;if(data&&void 0!==data.length)return data.length;throw new Error("Could not deduce numInstances")}},{key:"checkProps",value:function(oldProps,newProps){newProps.data!==oldProps.data&&(this.state.dataChanged=!0);var viewportChanged=newProps.width!==oldProps.width||newProps.height!==oldProps.height||newProps.latitude!==oldProps.latitude||newProps.longitude!==oldProps.longitude||newProps.zoom!==oldProps.zoom;this.setState({viewportChanged:viewportChanged})}},{key:"updateAttributes",value:function(props){var _state2=this.state,attributeManager=_state2.attributeManager,model=_state2.model,numInstances=this.getNumInstances(props);if(attributeManager.update({numInstances:numInstances,bufferMap:props,context:this,ignoreUnknownAttributes:!0}),model){var changedAttributes=attributeManager.getChangedAttributes({clearChangedFlags:!0});model.setAttributes(changedAttributes)}}},{key:"updateBaseUniforms",value:function(){this.setUniforms({opacity:Math.pow(this.props.opacity||.8,1/2.2)})}},{key:"checkUpdateTriggers",value:function(oldProps,newProps){var change=!1,attributeManager=this.state.attributeManager;for(var propName in newProps.updateTriggers){var oldTriggers=oldProps.updateTriggers[propName],newTriggers=newProps.updateTriggers[propName];(0,_util.areEqualShallow)(oldTriggers,newTriggers)||("all"===propName?(attributeManager.invalidateAll(),change=!0):(attributeManager.invalidate(propName),change=!0))}return change}},{key:"initializeLayer",value:function(_ref2){var gl=_ref2.gl;(0,_assert2["default"])(gl),this.state={gl:gl},this.setState({attributeManager:new _luma.AttributeManager({id:this.props.id}),model:null,needsRedraw:!0,dataChanged:!0});var attributeManager=this.state.attributeManager;attributeManager.addInstanced(ATTRIBUTES,{instancePickingColors:{update:this.calculateInstancePickingColors}}),this.setViewport(),this.initializeState(),(0,_assert2["default"])(this.state.model,"Model must be set in initializeState"),this.setViewport(),this.updateAttributes(this.props),this.updateBaseUniforms();var model=this.state.model;model.setInstanceCount(this.getNumInstances()),model.id=this.props.id,model.program.id=this.props.id+"-program",model.geometry.id=this.props.id+"-geometry",this._updateModel({gl:gl}),this.didMount()}},{key:"updateLayer",value:function(oldProps,newProps){this.checkProps(oldProps,newProps),this.shouldUpdate(oldProps,newProps)&&(this.state.viewportChanged&&this.setViewport(),this.willReceiveProps(oldProps,newProps),this.updateAttributes(newProps),this.updateBaseUniforms(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.state.dataChanged=!1,this.state.viewportChanged=!1}},{key:"finalizeLayer",value:function(){this.willUnmount()}},{key:"calculateInstancePickingColors",value:function(attribute,numInstances){for(var value=attribute.value,size=attribute.size,i=0;i<numInstances;i++){var pickingColor=this.encodePickingColor(i);value[i*size+0]=pickingColor[0],value[i*size+1]=pickingColor[1],value[i*size+2]=pickingColor[2]}}},{key:"decodePickingColor",value:function(color){(0,_assert2["default"])(color instanceof Uint8Array);var _color=_slicedToArray(color,3),i1=_color[0],i2=_color[1],i3=_color[2],index=i1+256*i2+65536*i3-1;return index}},{key:"encodePickingColor",value:function(i){return[(i+1)%256,Math.floor((i+1)/256)%256,Math.floor((i+1)/256/256)%256]}},{key:"onGetHoverInfo",value:function(info){var color=info.color;return info.index=this.decodePickingColor(color),Array.isArray(this.props.data)&&(info.object=this.props.data[info.index]),info.geoCoords=this.unproject({x:info.x,y:info.y}),info}},{key:"onHover",value:function(info){var _info=info,color=_info.color,selectedPickingColor=new Float32Array(3);return selectedPickingColor[0]=color[0],selectedPickingColor[1]=color[1],selectedPickingColor[2]=color[2],this.setUniforms({selectedPickingColor:selectedPickingColor}),info=this.onGetHoverInfo(info),this.props.onHover(info)}},{key:"onClick",value:function(info){return info=this.onGetHoverInfo(info),this.props.onClick(info)}},{key:"_updateModel",value:function(_ref3){var _state3=(_ref3.gl,this.state),model=_state3.model,attributeManager=_state3.attributeManager,uniforms=_state3.uniforms;(0,_assert2["default"])(model),model.setAttributes(attributeManager.getAttributes()),model.setUniforms(uniforms),model.setPickable(this.props.isPickable)}},{key:"checkProp",value:function(property,propertyName){if(void 0===property||null===property)throw new Error("Property "+propertyName+" undefined in layer "+this.props.id)}},{key:"setViewport",value:function(){var _props2=this.props,width=_props2.width,height=_props2.height,latitude=_props2.latitude,longitude=_props2.longitude,zoom=_props2.zoom;this.setState({viewport:{x:0,y:0,width:width,height:height},mercator:(0,_viewportMercatorProject2["default"])({width:width,height:height,latitude:latitude,longitude:longitude,zoom:zoom,tileSize:512})}),this.setUniforms({viewport:[0,0,width,height],mercatorScale:Math.pow(2,zoom),mercatorCenter:[longitude,latitude]}),(0,_log2["default"])(3,this.state.viewport,latitude,longitude,zoom)}},{key:"project",value:function(latLng){var mercator=this.state.mercator,_ref4=Array.isArray(latLng)?mercator.project([latLng[1],latLng[0]]):mercator.project([latLng.lon,latLng.lat]),_ref5=_slicedToArray(_ref4,2),x=_ref5[0],y=_ref5[1];return{x:x,y:y}}},{key:"unproject",value:function(xy){var mercator=this.state.mercator,_ref6=Array.isArray(xy)?mercator.unproject(xy):mercator.unproject([xy.x,xy.y]),_ref7=_slicedToArray(_ref6,2),lon=_ref7[0],lat=_ref7[1];return{lat:lat,lon:lon}}}]),Layer}();exports["default"]=Layer},114:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function timestampToString(t){var d=new Date(t),year=d.getUTCFullYear(),month=d.getUTCMonth()+1+"";1===month.length&&(month="0"+month);var date=d.getUTCDate()+"";return 1===date.length&&(date="0"+date),year+"-"+month+"-"+date}function enableContent(){return{type:ENABLE_CONTENT}}function setPage(){return function(dispatch,getState){"/journal"===location.pathname&&dispatch(checkFeedContent())}}function checkFeedContent(){return function(dispatch,getState){var state=getState(),expeditionID=state.selectedExpedition,expedition=state.expeditions[expeditionID],dayCount=expedition.dayCount,posts=d3.values(expedition.features),postsByDay=expedition.postsByDay,contentHeight=d3.select("#content").node().offsetHeight,scrollTop=d3.select("#content").node().scrollTop,feedElement=d3.select("#feed").node(),viewRange=[scrollTop,scrollTop+contentHeight];if(feedElement){var postElements=d3.select(feedElement).selectAll("div.post")._groups[0],visibleDays=[],visibleElements=[];postElements&&postElements.forEach(function(p){var postRange=[p.offsetTop-100,p.offsetTop+p.offsetHeight-100];(viewRange[0]>postRange[0]&&viewRange[0]<=postRange[1]||viewRange[0]<=postRange[0]&&viewRange[1]>postRange[0]||viewRange[1]>postRange[0]&&viewRange[1]<=postRange[1])&&visibleElements.push(p.className.split(" ")[1])}),visibleElements.forEach(function(p){var feature=expedition.features[p],day=Math.floor((new Date(feature.properties.DateTime).getTime()-expedition.start.getTime())/864e5);visibleDays.indexOf(day)===-1&&visibleDays.push(day)});for(var i=0;i<visibleDays.length-1;i++)if(Math.abs(visibleDays[i]-visibleDays[i+1])){dispatch(fetchPostsByDay(expeditionID,null,i));break}var feedHeight=feedElement.offsetHeight;(0===posts.length||feedHeight<contentHeight||scrollTop<=100&&!postsByDay[dayCount]||scrollTop>=feedHeight-contentHeight-100&&!postsByDay[0])&&dispatch(fetchPostsByDay(expeditionID,expedition.currentDate))}else(0===posts.length||scrollTop<=100&&!postsByDay[dayCount])&&dispatch(fetchPostsByDay(expeditionID,expedition.currentDate))}}function fetchPostsByDay(_expeditionID,date,expeditionDay){return function(dispatch,getState){var i,state=getState(),expeditionID=_expeditionID||state.selectedExpedition,expedition=state.expeditions[expeditionID];expeditionDay||(date||(date=expedition.currentDate),expeditionDay=Math.floor((date.getTime()-expedition.start.getTime())/864e5));var daysToFetch=[];if(expedition.postsByDay[expeditionDay]){if("loading"===expedition.postsByDay[expeditionDay])return;for(i=expeditionDay-1;i>=0&&"loading"!==expedition.postsByDay[i];i--)if(!expedition.postsByDay[i]){daysToFetch.push(i),daysToFetch[0]=i;break}for(i=expeditionDay+1;i<expedition.dayCount&&"loading"!==expedition.postsByDay[i];i++)if(!expedition.postsByDay[i]){daysToFetch.push(i);break}}else daysToFetch.push(expeditionDay);if(0!==daysToFetch.length){var datesToFetch=[];daysToFetch.forEach(function(d,i){var t=expedition.start.getTime()+864e5*d;datesToFetch[i]=t});var range=[timestampToString(d3.min(datesToFetch)),timestampToString(d3.max(datesToFetch)+864e5)];dispatch({type:FETCH_POSTS_BY_DAY,expeditionID:expeditionID,daysToFetch:daysToFetch});var queryString="https://intotheokavango.org/api/features?limit=0&FeatureType=blog,audio,image,tweet&limit=0&Expedition="+state.selectedExpedition+"&startDate="+range[0]+"&endDate="+range[1];(0,_isomorphicFetch2["default"])(queryString).then(function(response){return response.json()}).then(function(json){var results=json.results.features;return dispatch(receivePosts(expeditionID,results,range))}).then(function(){dispatch(checkFeedContent())})}}}function receivePosts(expeditionID,data,timeRange){return{type:RECEIVE_POSTS,expeditionID:expeditionID,data:data,timeRange:timeRange}}function completeDays(expeditionID){return{type:COMPLETE_DAYS,expeditionID:expeditionID}}function showLoadingWheel(){return{type:SHOW_LOADING_WHEEL}}function hideLoadingWheel(){return{type:HIDE_LOADING_WHEEL}}function jumpTo(date,expeditionID){return function(dispatch,getState){var state=getState(),expedition=state.expeditions[expeditionID],expeditionDay=Math.floor((date.getTime()-expedition.start.getTime())/864e5);return expedition.days[expeditionDay]?(dispatch(updateTime(date,!0,expeditionID)),dispatch(fetchDay(date))):(dispatch(showLoadingWheel()),dispatch(fetchDay(date)))}}function startAnimation(){return{type:START}}function requestExpeditions(){return{type:REQUEST_EXPEDITIONS}}function updateTime(currentDate,updateMapState,expeditionID){return{type:UPDATE_TIME,currentDate:currentDate,updateMapState:updateMapState,expeditionID:expeditionID}}function updateMap(currentDate,coordinates,viewGeoBounds,zoom,expeditionID){return function(dispatch,getState){var state=getState(),expedition=state.expeditions[expeditionID],tiles=expedition.featuresByTile,tileResolution=Math.floor(111*(expedition.geoBounds[2]-expedition.geoBounds[0])/10),coordinatesToTile=function(coordinates,geoBounds){var x=Math.floor(111*(coordinates[0]-geoBounds[0])/10),y=Math.floor(111*(coordinates[1]-geoBounds[3])/10);return{x:x,y:y}},tileToCoordinates=function(tile,geoBounds){var lng=10*tile.x/111+geoBounds[0],lat=10*tile.y/111+geoBounds[3];return[lng,lat]},west=viewGeoBounds[0],north=viewGeoBounds[1],east=viewGeoBounds[2],south=viewGeoBounds[3],centroid=[(west+east)/2,(south+north)/2];west=centroid[0]+Math.max(west-centroid[0],-.1),east=centroid[0]+Math.min(east-centroid[0],.1),north=centroid[1]+Math.min(north-centroid[1],.1),south=centroid[1]+Math.max(south-centroid[1],-.1);for(var northWestTile=coordinatesToTile([west,north],expedition.geoBounds),southEastTile=Object.assign({},northWestTile);tileToCoordinates(southEastTile,expedition.geoBounds)[0]<=east;)southEastTile.x++;for(;tileToCoordinates(southEastTile,expedition.geoBounds)[1]>=south;)southEastTile.y--;for(var tileRange=[],tilesInView=[],x=northWestTile.x;x<=southEastTile.x;x++)for(var y=northWestTile.y;y>=southEastTile.y;y--){var tile=x+y*tileResolution;tiles[tile]||tileRange.push({x:x,y:y}),tilesInView.push(x+y*tileResolution)}var queryNorthWest=[180,-90],querySouthEast=[-180,90];tileRange.forEach(function(t){var northWest=tileToCoordinates(t,expedition.geoBounds),southEast=tileToCoordinates({x:t.x+1,y:t.y-1},expedition.geoBounds);queryNorthWest[0]>northWest[0]&&(queryNorthWest[0]=northWest[0]),queryNorthWest[1]<northWest[1]&&(queryNorthWest[1]=northWest[1]),querySouthEast[0]<southEast[0]&&(querySouthEast[0]=southEast[0]),querySouthEast[1]>southEast[1]&&(querySouthEast[1]=southEast[1])});var queryGeoBounds=[queryNorthWest[0],queryNorthWest[1],querySouthEast[0],querySouthEast[1]];if(tileRange.forEach(function(t,i,a){a[i]=t.x+t.y*tileResolution}),tileRange.length>0){var queryString="https://intotheokavango.org/api/features?limit=0&FeatureType=blog,audio,image,tweet,sighting&Expedition="+state.selectedExpedition+"&geoBounds="+queryGeoBounds.toString();(0,_isomorphicFetch2["default"])(queryString).then(function(response){return response.json()}).then(function(json){var results=json.results.features;dispatch(receiveFeatures(state.selectedExpedition,results,tileRange))})}return dispatch({type:UPDATE_MAP,expeditionID:expeditionID,currentDate:currentDate,coordinates:coordinates,viewGeoBounds:viewGeoBounds,tilesInView:tilesInView,zoom:zoom,tileRange:tileRange})}}function receiveExpeditions(data){for(var k in data.results)data.results[k].Days<1&&delete data.results[k];return{type:RECEIVE_EXPEDITIONS,data:data}}function fetchExpeditions(){return function(dispatch,getState){return dispatch(requestExpeditions()),(0,_isomorphicFetch2["default"])("https://intotheokavango.org/api/expeditions").then(function(response){return response.json()}).then(function(json){return dispatch(receiveExpeditions(json))}).then(function(){return dispatch(fetchDay(new Date("2016-08-30 00:00:00+00:00"),null,null,!0))}).then(function(){var state=getState();dispatch(fetchTotalSightings(state.selectedExpedition)),"/journal"===location.pathname&&dispatch(checkFeedContent())})}}function fetchTotalSightings(id){return function(dispatch,getState){return(0,_isomorphicFetch2["default"])("https://intotheokavango.org/api/sightings?FeatureType=sighting&limit=0&Expedition="+id).then(function(response){return response.json()}).then(function(json){return dispatch(receiveTotalSightings(id,json))})}}function receiveTotalSightings(id,data){return{type:RECEIVE_TOTAL_SIGHTINGS,id:id,data:data}}function fetchDay(date,initialDate,_expeditionID,initialize){return initialDate||(initialDate=date),function(dispatch,getState){var state=getState(),expeditionID=_expeditionID||state.selectedExpedition,expedition=state.expeditions[expeditionID];date||(date=expedition.currentDate);var expeditionDay=Math.floor((date.getTime()-expedition.start.getTime())/864e5),daysToFetch=[];if(!expedition.days[expeditionDay-1]&&expeditionDay-1>=0&&daysToFetch.push(expeditionDay-1),expedition.days[expeditionDay]||daysToFetch.push(expeditionDay),!expedition.days[expeditionDay+1]&&expeditionDay+1<expedition.dayCount&&daysToFetch.push(expeditionDay+1),0!==daysToFetch.length){daysToFetch.forEach(function(d,i,a){var t=expedition.start.getTime()+864e5*d;a[i]=t});var range=[timestampToString(d3.min(daysToFetch)),timestampToString(d3.max(daysToFetch)+864e5)],goFetch=function goFetch(featureTypes,results,expeditionID){var type=featureTypes.shift(),queryString="https://intotheokavango.org/api/features?limit=0&FeatureType="+type+"&Expedition="+expeditionID+"&startDate="+range[0]+"&endDate="+range[1];"ambit_geo"===type&&(queryString+="&resolution=5"),(0,_isomorphicFetch2["default"])(queryString).then(function(response){return response.json()}).then(function(json){if(results=results.concat(json.results.features),featureTypes.length>0)goFetch(featureTypes,results,expeditionID);else{dispatch(receiveDay(expeditionID,results,range)),dispatch(completeDays(expeditionID));var state=getState(),expedition=state.expeditions[state.selectedExpedition],days=expedition.days,incompleteDays=[];if(d3.keys(expedition.days).forEach(function(k){expedition.days[k].incomplete&&incompleteDays.push(k)}),0===incompleteDays.length)!state.animate&&initialize&&dispatch(startAnimation()),dispatch(updateTime(new Date("2016-08-30 00:00:00+00:00"),!1,expeditionID)),dispatch(hideLoadingWheel());else{for(var nextTarget=-1,i=0;i<incompleteDays.length;i++){for(var id=incompleteDays[i],j=Math.max(0,id-1);j<expedition.dayCount;j++)if(!days[j]){nextTarget=j;break}if(nextTarget>-1)break}nextTarget>-1&&(nextTarget=new Date(expedition.start.getTime()+864e5*nextTarget),dispatch(fetchDay(nextTarget,null,expeditionID,initialize)))}}})};goFetch(["ambit_geo","beacon"],[],expeditionID)}}}function setExpedition(id){return function(dispatch,getState){var state=getState(),expedition=state.expeditions[id];0===expedition.totalSightings.length&&dispatch(fetchTotalSightings(id)),dispatch({type:SET_EXPEDITION,id:id})}}function setControl(target,mode){return{type:SET_CONTROL,target:target,mode:mode}}function requestDay(expeditionID,dayID){return{type:REQUEST_DAY,expeditionID:expeditionID,dayID:dayID}}function receiveDay(expeditionID,data,dateRange){return{type:RECEIVE_DAY,expeditionID:expeditionID,data:data,dateRange:dateRange}}function receiveFeatures(expeditionID,data,tileRange){return{type:RECEIVE_FEATURES,expeditionID:expeditionID,data:data,tileRange:tileRange}}function selectFeature(){return{type:SELECT_FEATURE}}function unselectFeature(){return{type:UNSELECT_FEATURE}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.UNSELECT_FEATURE=exports.SELECT_FEATURE=exports.RECEIVE_FEATURES=exports.RECEIVE_DAY=exports.REQUEST_DAY=exports.SET_CONTROL=exports.SET_EXPEDITION=exports.RECEIVE_TOTAL_SIGHTINGS=exports.RECEIVE_EXPEDITIONS=exports.UPDATE_MAP=exports.UPDATE_TIME=exports.REQUEST_EXPEDITIONS=exports.START=exports.JUMP_TO=exports.HIDE_LOADING_WHEEL=exports.SHOW_LOADING_WHEEL=exports.COMPLETE_DAYS=exports.RECEIVE_POSTS=exports.FETCH_POSTS_BY_DAY=exports.SET_PAGE=exports.ENABLE_CONTENT=void 0,exports.enableContent=enableContent,exports.setPage=setPage,exports.checkFeedContent=checkFeedContent,exports.fetchPostsByDay=fetchPostsByDay,exports.receivePosts=receivePosts,exports.completeDays=completeDays,exports.showLoadingWheel=showLoadingWheel,exports.hideLoadingWheel=hideLoadingWheel,exports.jumpTo=jumpTo,exports.startAnimation=startAnimation,exports.requestExpeditions=requestExpeditions,exports.updateTime=updateTime,exports.updateMap=updateMap,exports.receiveExpeditions=receiveExpeditions,exports.fetchExpeditions=fetchExpeditions,exports.fetchTotalSightings=fetchTotalSightings,exports.receiveTotalSightings=receiveTotalSightings,exports.fetchDay=fetchDay,exports.setExpedition=setExpedition,exports.setControl=setControl,exports.requestDay=requestDay,exports.receiveDay=receiveDay,exports.receiveFeatures=receiveFeatures,exports.selectFeature=selectFeature,exports.unselectFeature=unselectFeature;var _isomorphicFetch=__webpack_require__(726),_isomorphicFetch2=_interopRequireDefault(_isomorphicFetch),_d=__webpack_require__(90),d3=_interopRequireWildcard(_d),ENABLE_CONTENT=exports.ENABLE_CONTENT="ENABLE_CONTENT",FETCH_POSTS_BY_DAY=(exports.SET_PAGE="SET_PATH",exports.FETCH_POSTS_BY_DAY="FETCH_POSTS_BY_DAY"),RECEIVE_POSTS=exports.RECEIVE_POSTS="RECEIVE_POSTS",COMPLETE_DAYS=exports.COMPLETE_DAYS="COMPLETE_DAYS",SHOW_LOADING_WHEEL=exports.SHOW_LOADING_WHEEL="SHOW_LOADING_WHEEL",HIDE_LOADING_WHEEL=exports.HIDE_LOADING_WHEEL="HIDE_LOADING_WHEEL",START=(exports.JUMP_TO="JUMP_TO",exports.START="START"),REQUEST_EXPEDITIONS=exports.REQUEST_EXPEDITIONS="REQUEST_EXPEDITIONS",UPDATE_TIME=exports.UPDATE_TIME="UPDATE_TIME",UPDATE_MAP=exports.UPDATE_MAP="UPDATE_MAP",RECEIVE_EXPEDITIONS=exports.RECEIVE_EXPEDITIONS="RECEIVE_EXPEDITIONS",RECEIVE_TOTAL_SIGHTINGS=exports.RECEIVE_TOTAL_SIGHTINGS="RECEIVE_TOTAL_SIGHTINGS",SET_EXPEDITION=exports.SET_EXPEDITION="SET_EXPEDITION",SET_CONTROL=exports.SET_CONTROL="SET_CONTROL",REQUEST_DAY=exports.REQUEST_DAY="REQUEST_DAY",RECEIVE_DAY=exports.RECEIVE_DAY="RECEIVE_DAY",RECEIVE_FEATURES=exports.RECEIVE_FEATURES="RECEIVE_FEATURES",SELECT_FEATURE=exports.SELECT_FEATURE="SELECT_FEATURE",UNSELECT_FEATURE=exports.UNSELECT_FEATURE="UNSELECT_FEATURE"},172:function(module,exports){"use strict";function dateToString(d,short){var month=d.getUTCMonth()+1,day=d.getUTCDate(),hour=d.getUTCHours()+"";1===hour.length&&(hour="0"+hour);var minute=d.getUTCMinutes()+"";1===minute.length&&(minute="0"+minute);var monthString="";return 1===month&&(monthString="January"),2===month&&(monthString="February"),3===month&&(monthString="March"),4===month&&(monthString="April"),5===month&&(monthString="May"),6===month&&(monthString="June"),7===month&&(monthString="July"),8===month&&(monthString="August"),9===month&&(monthString="September"),10===month&&(monthString="October"),11===month&&(monthString="November"),12===month&&(monthString="December"),short&&(monthString=monthString.slice(0,3)),monthString+" "+day+", "+hour+":"+minute}function lerp(start,end,ratio){return start+(end-start)*ratio}Object.defineProperty(exports,"__esModule",{value:!0}),exports.dateToString=dateToString,exports.lerp=lerp},247:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_utils=__webpack_require__(172),Post=function(_ref){var format=_ref.format,data=_ref.data;if("full"===format){var metaTypes=["date"];data.location&&metaTypes.push("location"),data.link&&metaTypes.push("link");var meta=metaTypes.map(function(m,i){var value=function(){if("date"===m){var d=new Date(data.date);return _react2["default"].createElement("p",null,(0,_utils.dateToString)(d,!0))}if("full"===format)return _react2["default"].createElement("img",{width:"16",height:"16",key:i,src:"/static/img/icon-"+m+".png"})}();return _react2["default"].createElement("div",{className:m,key:i},value)}),content=function(data){switch(data.type){case"tweet":var images=data.images?data.images.map(function(url,i){return _react2["default"].createElement("img",{src:url,key:i})}):"";return _react2["default"].createElement("div",null,_react2["default"].createElement("p",{className:"message"},'"',data.content,'"'),images);case"image":return _react2["default"].createElement("div",null,_react2["default"].createElement("img",{src:data.images[0]}),_react2["default"].createElement("p",null,data.content));case"audio":var soundCloudURL="https://w.soundcloud.com/player/?url=";return soundCloudURL+=data.link,soundCloudURL+="&color=F8D143&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false",_react2["default"].createElement("div",null,_react2["default"].createElement("h2",null,data.title),_react2["default"].createElement("p",null,"sound"),_react2["default"].createElement("iframe",{src:soundCloudURL}));case"blog":return _react2["default"].createElement("div",null,_react2["default"].createElement("h2",null,data.title),_react2["default"].createElement("p",null,data.content),_react2["default"].createElement("p",null,_react2["default"].createElement("a",{href:data.link},"Read more...")));default:return""}};return _react2["default"].createElement("div",{className:"post "+data.key},_react2["default"].createElement("div",{className:"type"},_react2["default"].createElement("img",{width:"16",height:"16",src:"/static/img/icon-"+data.type+".png"})),_react2["default"].createElement("div",{className:"content"},content(data),_react2["default"].createElement("div",{className:"meta"},meta,_react2["default"].createElement("div",{className:"share"},_react2["default"].createElement("img",{width:"16",height:"16",src:"static/img/icon-share.png"})),_react2["default"].createElement("div",{className:"separator"}))))}return""};Post.propTypes={format:_react.PropTypes.string.isRequired,data:_react.PropTypes.object.isRequired},exports["default"]=Post},248:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _reactRedux=__webpack_require__(134),_ControlPanel=__webpack_require__(434),_ControlPanel2=_interopRequireDefault(_ControlPanel),_actions=__webpack_require__(114),actions=_interopRequireWildcard(_actions),mapStateToProps=function(state,ownProps){var props={currentPage:state.currentPage,expeditionID:state.selectedExpedition,expeditions:state.expeditions},expedition=state.expeditions[state.selectedExpedition];return props.expeditionID&&(props.currentDate=expedition.currentDate,props.playback=expedition.playback,props.mainFocus=expedition.mainFocus,props.secondaryFocus=expedition.secondaryFocus,props.zoom=expedition.zoom,props.layout=expedition.layout,props.viewport={width:window.innerWidth,height:window.innerHeight,longitude:expedition.coordinates[0],latitude:expedition.coordinates[1],zoom:expedition.zoom}),props},mapDispatchToProps=function(dispatch,ownProps){return{onYearChange:function(value){return dispatch(actions.setExpedition(value))},onPlaybackChange:function(value){return dispatch(actions.setControl("playback",value))},onMainFocusChange:function(value){return dispatch(actions.setControl("mainFocus",value))},onSecondaryFocusChange:function(value){return dispatch(actions.setControl("secondaryFocus",value))},onZoomChange:function(value){return dispatch(actions.setControl("zoom",value))},onLayoutChange:function(value){return dispatch(actions.setControl("layout",value))}}},ControlPanelContainer=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_ControlPanel2["default"]);exports["default"]=ControlPanelContainer},249:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function log(priority){if((0,_assert2["default"])("number"==typeof priority),priority<=log.priority){for(var _console,_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];(_console=console).debug.apply(_console,args);
}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=log;var _assert=__webpack_require__(5),_assert2=_interopRequireDefault(_assert);log.priority=0,"undefined"!=typeof window&&(window.log=log)},431:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),APIExplorer=function(){return _react2["default"].createElement("p",null,"Coming soon...")};exports["default"]=APIExplorer},432:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),AboutPage=function(){return _react2["default"].createElement("div",{className:"page",id:"aboutPage"},_react2["default"].createElement("div",{className:"pageWrapper"},_react2["default"].createElement("iframe",{className:"vimeo",src:"https://player.vimeo.com/video/124421450?autoplay=0&api=1",width:.9*window.innerWidth,height:.9*window.innerWidth*.525,frameBorder:"0",allowFullScreen:!0}),_react2["default"].createElement("div",{className:"columnWrapper"},_react2["default"].createElement("div",{className:"column headline"},_react2["default"].createElement("p",null,"18 days, 345 kilometers,",_react2["default"].createElement("br",null),"1 river, 31 adventurers, 100% open data.",_react2["default"].createElement("br",null),"Join us in real-time as we explore"),_react2["default"].createElement("h1",null,"THE BEATING HEART OF OUR PLANET")),_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("p",null,"The Okavango Delta is one of the world’s last great wetland wildernesses. Although the Delta has been awarded UNESCO WHS Status its catchments in the highlands of Angola are still unprotected and largely unstudied. A team of Ba’Yei, scientists, engineers and adventurers will journey a 345 kilometers crossing the river, finding new species, exploring new ground, and taking the pulse of this mighty river that brings life-giving water to the Jewel of the Kalahari."),_react2["default"].createElement("p",null,"This site displays data which is uploaded daily, via satellite, by the expedition team. Data is also available through a public API, allowing anyone to remix, analyze or visualize the collected information."))),_react2["default"].createElement("div",{className:"columnWrapper"},_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("div",{className:"goalIcon"},_react2["default"].createElement("img",{src:"static/img/iconIntroUnderstand.png"})),_react2["default"].createElement("h2",null,"UNDERSTAND",_react2["default"].createElement("br",null),"THE WILDERNESS"),_react2["default"].createElement("p",null,"To effectively protect the Okavango and its catchments it is essential to gain knowledge and insight into the functioning of the system as a whole. Starting in 2011 the Okavango Wilderness Project has conducted yearly transects of the Delta, gathering unique data and immersing the expedition members in the ebb and flow of this pristine wilderness. Traveling down the river, the team will collect data on insects, fish, birds, reptiles and mammals, as well as conduct water quality assessments and landscape surveys.")),_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("div",{className:"goalIcon"},_react2["default"].createElement("img",{src:"static/img/iconIntroPreserve.png"})),_react2["default"].createElement("h2",null,"RAISE AWARENESS",_react2["default"].createElement("br",null),"AND PRESERVE"),_react2["default"].createElement("p",null,"Although the Okavango itself is protected as a UNESCO World Heritage Site, its catchment and water supply in Angola and Namibia remain vulnerable to human interference. By gathering and freely disseminating information about the functioning and health of the entire system the 2016 expedition aims to raise the levels of both understanding and awareness of this unique and fragile system."),_react2["default"].createElement("p",null,"Once base-line data on the system becomes freely available effective measures can then be implemented to insure the continued health and survival of this great African wilderness."))),_react2["default"].createElement("div",{className:"columnWrapper credits"},_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("h2",null,"EXPEDITION TEAM",_react2["default"].createElement("br",null),_react2["default"].createElement("span",{className:"job"},_react2["default"].createElement("span",{className:"explorerBox legend"})," National Geographic Emerging Explorers")),_react2["default"].createElement("p",null,"Adjany Costa ",_react2["default"].createElement("span",{className:"job"},"Assistant Director & 2nd Fish"),_react2["default"].createElement("br",null),"Chris Boyes ",_react2["default"].createElement("span",{className:"job"},"Expeditions Leader"),_react2["default"].createElement("br",null),'Gobonamang "GB" Kgetho ',_react2["default"].createElement("span",{className:"job"},"Poler"),_react2["default"].createElement("br",null),"Gotz Neef ",_react2["default"].createElement("span",{className:"job"},"Scienetific Collections & Leader Invertebrates"),_react2["default"].createElement("br",null),"Jer Thorp ",_react2["default"].createElement("span",{className:"job"},"Data"),_react2["default"].createElement("br",null),"John Hilton ",_react2["default"].createElement("span",{className:"job"},"Project Director"),_react2["default"].createElement("br",null),"Kerllen Costa ",_react2["default"].createElement("span",{className:"job"},"Plants & Mammals"),_react2["default"].createElement("br",null),"Kyle Gordon ",_react2["default"].createElement("span",{className:"job"},"Expedition Logistics"),_react2["default"].createElement("br",null),'Leilamang "Schnapps" Kgetho ',_react2["default"].createElement("span",{className:"job"},"Poler"),_react2["default"].createElement("br",null),"Luke Manson ",_react2["default"].createElement("span",{className:"job"},"Expedition Logistics"),_react2["default"].createElement("br",null),"Mia Maestro ",_react2["default"].createElement("span",{className:"job"},"Photographer"),_react2["default"].createElement("br",null),"Motiemang “Judge” Xhikabora ",_react2["default"].createElement("span",{className:"job"},"Poler"),_react2["default"].createElement("br",null),"Neil Gelinas ",_react2["default"].createElement("span",{className:"job"},"Filmmaker"),_react2["default"].createElement("br",null),"Ninda Baptista ",_react2["default"].createElement("span",{className:"job"},"Reptiles"),_react2["default"].createElement("br",null),"Nkeletsang “Ralph” Moshupa ",_react2["default"].createElement("span",{className:"job"},"Poler"),_react2["default"].createElement("br",null),"Rachel Sussman ",_react2["default"].createElement("span",{className:"job"},"Photographer"),_react2["default"].createElement("br",null),"Shah Selbe ",_react2["default"].createElement("span",{className:"job"},"Tech"),_react2["default"].createElement("br",null),"Steve Boyes ",_react2["default"].createElement("span",{className:"job"},"Project Leader & Birds"),_react2["default"].createElement("br",null),'Topho "Tom" Retiyo ',_react2["default"].createElement("span",{className:"job"},"Poler"),_react2["default"].createElement("br",null),'Tumeleto "Water" Setlabosha',_react2["default"].createElement("span",{className:"job"},"Poler"),_react2["default"].createElement("br",null))),_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("div",{className:"logos"},_react2["default"].createElement("a",{href:"http://www.nationalgeographic.com/"},_react2["default"].createElement("img",{src:"static/img/natgeoLogo.svg",alt:"National Geographic Logo",height:"35px"})),_react2["default"].createElement("a",{href:"http://conservify.org/"},_react2["default"].createElement("img",{src:"static/img/conservify.png",alt:"Conservify Logo",height:"35px"})),_react2["default"].createElement("a",{href:"http://www.o-c-r.org/"},_react2["default"].createElement("img",{src:"static/img/ocrLogo.svg",alt:"The Office for Creative Research Logo",height:"35px"})),_react2["default"].createElement("a",{href:"http://www.wildbirdtrust.com/"},_react2["default"].createElement("img",{src:"static/img/wbtLogo.png",alt:"Wild Bird Trust Logo",height:"35px"})))))))};AboutPage.propTypes={},exports["default"]=AboutPage},433:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}Object.defineProperty(exports,"__esModule",{value:!0});var _class,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_reactMapGl=__webpack_require__(894),_reactMapGl2=_interopRequireDefault(_reactMapGl),_autobindDecorator=__webpack_require__(46),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),_d=__webpack_require__(90),d3=_interopRequireWildcard(_d),_utils=__webpack_require__(172),_viewportMercatorProject=(_interopRequireWildcard(_utils),__webpack_require__(79)),_viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject),_deck=__webpack_require__(480),BackgroundMap=(_class=function(_React$Component){function BackgroundMap(props){_classCallCheck(this,BackgroundMap);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(BackgroundMap).call(this,props));return _this.state={contentActive:!1,animate:!1,coordinates:[0,0],viewport:{latitude:-18.5699229,longitude:22.115456,zoom:4,width:window.innerWidth,height:window.innerHeight,startDragLngLat:null,isDragging:!1}},_this}return _inherits(BackgroundMap,_React$Component),_createClass(BackgroundMap,[{key:"tick",value:function(pastFrameDate){var b1,b2,_this2=this,speedFactor=(Date.now()-pastFrameDate)/(1e3/60),currentFrameDate=Date.now(),_props=this.props,expeditionID=_props.expeditionID,animate=_props.animate,expedition=_props.expedition,fetchDay=_props.fetchDay,setControl=_props.setControl,isFetching=_props.isFetching,updateMap=_props.updateMap,initialPage=_props.initialPage;if(animate&&!isFetching&&"/map"===location.pathname||"/"===location.pathname){var dateOffset,forward,offset,currentDate,currentDay,beacons,beaconCount,beaconIndex,timeToNextBeacon,ratioBetweenBeacons,i,currentBeacon,nextBeacon,coordinates,zoom;!function(){dateOffset=0,forward="fastForward"===expedition.playback||"forward"===expedition.playback||"pause"===expedition.playback,_this2.state.beaconIndex===(forward?0:1)||_this2.state.beaconIndex===(forward?d3.values(_this2.state.day.beacons).length-2:d3.values(_this2.state.day.beacons).length-1)?(offset=_this2.state.timeToNextBeacon>0?Math.min(1e5,_this2.state.timeToNextBeacon+1):1e5,"fastBackward"!==expedition.playback&&"backward"!==expedition.playback||(dateOffset=-1*offset),"forward"!==expedition.playback&&"fastForward"!==expedition.playback||(dateOffset=offset)):("fastBackward"===expedition.playback&&(dateOffset=-25e3),"backward"===expedition.playback&&(dateOffset=-4e3),"forward"===expedition.playback&&(dateOffset=4e3),"fastForward"===expedition.playback&&(dateOffset=25e3)),currentDate=new Date(Math.min(expedition.end.getTime()-1,Math.max(expedition.start.getTime()+1,_this2.state.currentDate.getTime()+dateOffset))),(currentDate.getTime()!==expedition.end.getTime()-1||"forward"!==expedition.playback&&"fastForward"!==expedition.playback)&&(currentDate.getTime()!==expedition.start.getTime()+1||"backward"!==expedition.playback&&"fastBackward"!==expedition.playback)||setControl("playback","pause"),currentDay=Math.floor((currentDate.getTime()-expedition.start.getTime())/864e5),currentDay!==_this2.state.currentDay&&fetchDay(currentDate);var day=expedition.days[currentDay];if(beacons=d3.values(day.beacons).sort(function(a,b){return new Date(a.properties.DateTime).getTime()-new Date(b.properties.DateTime).getTime()}),beaconCount=beacons.length,timeToNextBeacon=0,ratioBetweenBeacons=0,"forward"===expedition.playback||"fastForward"===expedition.playback||"pause"===expedition.playback){for(i=0;i<beaconCount-1;i++)if(b1=new Date(beacons[i].properties.DateTime).getTime(),b2=new Date(beacons[i+1].properties.DateTime).getTime(),currentDate.getTime()>=b1&&currentDate.getTime()<b2){beaconIndex=i,timeToNextBeacon=b2-currentDate.getTime(),ratioBetweenBeacons=(currentDate.getTime()-b1)/(b2-b1);break}beaconIndex<0&&(beaconIndex=beaconCount-1)}else{for(i=beaconCount-1;i>0;i--)if(b1=new Date(beacons[i].properties.DateTime).getTime(),b2=new Date(beacons[i-1].properties.DateTime).getTime(),currentDate.getTime()<=b1&&currentDate.getTime()>b2){beaconIndex=i,timeToNextBeacon=currentDate.getTime()-b2,ratioBetweenBeacons=(currentDate.getTime()-b1)/(b2-b1);break}beaconIndex<0&&(beaconIndex=0)}currentBeacon=beacons[beaconIndex+0],nextBeacon=beacons[beaconIndex+(forward?1:-1)],coordinates=[(0,_utils.lerp)(currentBeacon.geometry.coordinates[0],nextBeacon.geometry.coordinates[0],ratioBetweenBeacons),(0,_utils.lerp)(currentBeacon.geometry.coordinates[1],nextBeacon.geometry.coordinates[1],ratioBetweenBeacons)];var members=_extends({},expedition.members);if(Object.keys(members).forEach(function(memberID){var member=members[memberID],ambits=d3.values(expedition.featuresByMember[memberID][currentDay]).sort(function(a,b){return new Date(a.properties.DateTime).getTime()-new Date(b.properties.DateTime).getTime()}),ambitCount=ambits.length,ambitIndex=-1,ratioBetweenAmbits=0;if("forward"===expedition.playback||"fastForward"===expedition.playback||"pause"===expedition.playback){for(var i=0;i<ambitCount-1;i++)if(b1=new Date(ambits[i].properties.DateTime).getTime(),b2=new Date(ambits[i+1].properties.DateTime).getTime(),currentDate.getTime()>=b1&&currentDate.getTime()<b2){ambitIndex=i,ratioBetweenAmbits=(currentDate.getTime()-b1)/(b2-b1);break}ambitIndex<0&&(ambitIndex=ambitCount-2,ratioBetweenAmbits=1)}else{for(i=ambitCount-1;i>0;i--)if(b1=new Date(ambits[i].properties.DateTime).getTime(),b2=new Date(ambits[i-1].properties.DateTime).getTime(),currentDate.getTime()<=b1&&currentDate.getTime()>b2){ambitIndex=i,ratioBetweenAmbits=(currentDate.getTime()-b1)/(b2-b1);break}ambitIndex<0&&(ambitIndex=1,ratioBetweenAmbits=1)}var currentID=ambitIndex,nextID=ambitIndex+(forward?1:-1);if(currentID>=0&&currentID<ambits.length&&nextID>=0&&nextID<ambits.length){var currentAmbits=ambits[currentID],nextAmbit=ambits[nextID];member.coordinates=[(0,_utils.lerp)(currentAmbits.geometry.coordinates[0],nextAmbit.geometry.coordinates[0],ratioBetweenAmbits),(0,_utils.lerp)(currentAmbits.geometry.coordinates[1],nextAmbit.geometry.coordinates[1],ratioBetweenAmbits)]}else member.coordinates=[-180,90]}),zoom=(0,_utils.lerp)(_this2.state.viewport.zoom,_this2.state.viewport.targetZoom,Math.pow(_this2.state.viewport.zoom/_this2.state.viewport.targetZoom,2)/250*speedFactor),("/"!==initialPage&&"/map"!==initialPage||!_this2.state.contentActive&&_this2.props.contentActive)&&(zoom=_this2.state.viewport.targetZoom),_this2.setState({currentDate:currentDate,animate:animate,currentDay:currentDay,day:day,beaconIndex:beaconIndex,timeToNextBeacon:timeToNextBeacon,members:members,contentActive:_this2.props.contentActive,viewport:_extends({},_this2.state.viewport,{longitude:coordinates[0],latitude:coordinates[1],zoom:zoom})}),_this2.state.frameCount%60===0){var _ViewportMercator=(0,_viewportMercatorProject2["default"])(_extends({},_this2.state.viewport)),unproject=_ViewportMercator.unproject,nw=unproject([0,0]),se=unproject([window.innerWidth,window.innerHeight]),viewGeoBounds=[nw[0],nw[1],se[0],se[1]];updateMap(_this2.state.currentDate,[_this2.state.viewport.longitude,_this2.state.viewport.latitude],viewGeoBounds,_this2.state.viewport.zoom,expeditionID)}}()}this.state.animate=animate,this.state.frameCount++,requestAnimationFrame(function(){_this2.tick(currentFrameDate)})}},{key:"componentWillReceiveProps",value:function(nextProps){var animate=nextProps.animate,expedition=nextProps.expedition,mapStateNeedsUpdate=nextProps.mapStateNeedsUpdate;if(animate){var currentDate=expedition.currentDate,currentDay=Math.floor((currentDate.getTime()-expedition.start.getTime())/864e5),day=expedition.days[currentDay];mapStateNeedsUpdate&&(this.state.currentDate=currentDate,this.state.currentDay=currentDay,this.state.day=day,this.state.frameCount=0),this.state.animate||(this.state.animate=animate,this.state.viewport=_extends({},this.state.viewport,{zoom:expedition.initialZoom,targetZoom:expedition.targetZoom}),this.tick(Math.round(Date.now()-1e3/60)))}}},{key:"redrawSVGOverlay",value:function(_ref){var project=_ref.project;this.props.expedition;return _react2["default"].createElement("g",null,_react2["default"].createElement("g",null,this.drawAmbits(project)),_react2["default"].createElement("g",null,this.drawMembers(project)),_react2["default"].createElement("g",null,this.drawPosts(project)))}},{key:"drawPosts",value:function(project){return""}},{key:"drawMembers",value:function(project){var members=this.state.members;if(!members||0===members.length)return"";var markers=Object.keys(members).map(function(memberID){var member=members[memberID],translate=function(member){var coords=project(member.coordinates),x=Math.round(10*(coords[0]-13.5))/10,y=Math.round(10*(coords[1]-34))/10;return"translate("+x+","+y+")"};return _react2["default"].createElement("g",{transform:translate(member),key:memberID},_react2["default"].createElement("path",{fill:"rgba(4,0,26,0.7)",d:"M27,13.8C27,22.2,13.5,34,13.5,34S0,22.2,0,13.8C0,6.3,6,0.3,13.5,0.3S27,6.3,27,13.8z"}),_react2["default"].createElement("text",{style:{textAnchor:"middle"},x:13.5,y:19,fill:"white"},memberID.slice(0,1).toUpperCase()))});return markers}},{key:"drawAmbits",value:function(project){var expedition=this.props.expedition,paths=expedition.currentAmbits.map(function(route,index){var points=route.coordinates.map(project).map(function(p){return[p[0],p[1]]});return _react2["default"].createElement("g",{key:index},_react2["default"].createElement("g",{style:{pointerEvents:"click",cursor:"pointer"}},_react2["default"].createElement("g",{style:{pointerEvents:"visibleStroke"}},_react2["default"].createElement("path",{style:{fill:"none",stroke:route.color,strokeWidth:2},d:"M"+points.join("L")}))))});return paths}},{key:"render",value:function(){var expedition=this.props.expedition,viewport=this.state.viewport,MAPBOX_ACCESS_TOKEN="pk.eyJ1IjoiaWFhYWFuIiwiYSI6ImNpbXF1ZW4xOTAwbnl3Ymx1Y2J6Mm5xOHYifQ.6wlNzSdcTlonLBH-xcmUdQ",MAPBOX_STYLE="mapbox://styles/mapbox/satellite-v9";return _react2["default"].createElement("div",{id:"mapbox",style:{zIndex:("/map"===location.pathname||"/"===location.pathname,-100)}},_react2["default"].createElement(_reactMapGl2["default"],_extends({},viewport,{mapStyle:MAPBOX_STYLE,mapboxApiAccessToken:MAPBOX_ACCESS_TOKEN}),expedition?_react2["default"].createElement("div",null,_react2["default"].createElement(_reactMapGl.SVGOverlay,_extends({},viewport,{startDragLngLat:[0,0],redraw:this.redrawSVGOverlay})),_react2["default"].createElement(_deck.DeckGLOverlay,_extends({},viewport,{startDragLngLat:[0,0],layers:[new _deck.ScatterplotLayer(_extends({},viewport,{id:"sightings",data:expedition.currentSightings}))]}))):""))}}]),BackgroundMap}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"tick",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"tick"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"redrawSVGOverlay",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"redrawSVGOverlay"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"drawPosts",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"drawPosts"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"drawMembers",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"drawMembers"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"drawAmbits",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"drawAmbits"),_class.prototype),_class);BackgroundMap.propTypes={animate:_react.PropTypes.bool.isRequired,expedition:_react.PropTypes.object,updateMap:_react.PropTypes.func.isRequired,fetchDay:_react.PropTypes.func.isRequired,setControl:_react.PropTypes.func.isRequired,mapStateNeedsUpdate:_react.PropTypes.bool.isRequired,initialPage:_react.PropTypes.string.isRequired,contentActive:_react.PropTypes.bool},exports["default"]=BackgroundMap},434:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_YearSelector=__webpack_require__(454),_DateSelector=(_interopRequireDefault(_YearSelector),__webpack_require__(437)),_DateSelector2=_interopRequireDefault(_DateSelector),_PlaybackSelector=__webpack_require__(450),_PlaybackSelector2=_interopRequireDefault(_PlaybackSelector),_FocusSelector=__webpack_require__(439),_ZoomSelector=(_interopRequireDefault(_FocusSelector),__webpack_require__(455)),_ZoomSelector2=_interopRequireDefault(_ZoomSelector),_LayoutSelector=__webpack_require__(442),ControlPanel=(_interopRequireDefault(_LayoutSelector),function(_ref){var pathName=_ref.pathName,expeditionID=_ref.expeditionID,expeditions=_ref.expeditions,currentDate=_ref.currentDate,playback=_ref.playback,onPlaybackChange=(_ref.mainFocus,_ref.secondaryFocus,_ref.zoom,_ref.layout,_ref.onYearChange,_ref.onPlaybackChange),onZoomChange=(_ref.onMainFocusChange,_ref.onSecondaryFocusChange,_ref.onZoomChange),viewport=(_ref.onLayoutChange,_ref.viewport);return expeditionID?("/"===pathName&&(pathName="/map"),_react2["default"].createElement("div",{className:"controlPanel"},_react2["default"].createElement(_DateSelector2["default"],{expeditions:expeditions,expeditionID:expeditionID,currentDate:currentDate}),"/map"===pathName?_react2["default"].createElement(_PlaybackSelector2["default"],{mode:playback,onPlaybackChange:onPlaybackChange}):null,"/map"===pathName&&window.innerWidth>768?_react2["default"].createElement(_ZoomSelector2["default"],{onZoomChange:onZoomChange,viewport:viewport}):null)):_react2["default"].createElement("div",{className:"controlPanel"})});ControlPanel.propTypes={pathName:_react.PropTypes.string.isRequired,expeditionID:_react.PropTypes.string,expeditions:_react.PropTypes.object,currentDate:_react.PropTypes.object,playback:_react.PropTypes.string,mainFocus:_react.PropTypes.string,secondaryFocus:_react.PropTypes.string,zoom:_react.PropTypes.number,layout:_react.PropTypes.string,onYearChange:_react.PropTypes.func.isRequired,onPlaybackChange:_react.PropTypes.func.isRequired,onMainFocusChange:_react.PropTypes.func.isRequired,onSecondaryFocusChange:_react.PropTypes.func.isRequired,onZoomChange:_react.PropTypes.func.isRequired,onLayoutChange:_react.PropTypes.func.isRequired,viewPort:_react.PropTypes.object},exports["default"]=ControlPanel},435:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_DataPageIndex=__webpack_require__(436),_DataPageIndex2=_interopRequireDefault(_DataPageIndex),_APIExplorer=__webpack_require__(431),_APIExplorer2=_interopRequireDefault(_APIExplorer),DataPage=function(){var sections=[{key:1,title:"Overview",content:_react2["default"].createElement("div",null,_react2["default"].createElement("p",null,"The Okavango Database is a growing record of data generated by the explorers and scientists on their 120 day expedition to the Okavango Delta. The database encompasses ",_react2["default"].createElement("em",null,"wildlife sightings, tweets, audio recordings")," and ",_react2["default"].createElement("em",null,"images")," taken by the participants, as well as ",_react2["default"].createElement("em",null,"sensor measurements")," capturing things like ",_react2["default"].createElement("em",null,"temperature, pH levels, and heart rates"),"."),_react2["default"].createElement("p",null,"The intention of the Okavango Database API is to share the data in almost real-time as it’s uploaded, so that people all over the world can follow the journey as it unfolds. It also allows for others to use the data for their own purposes. Below are examples of cool things people have build with our API."))},{key:2,title:"Explore",content:_react2["default"].createElement(_APIExplorer2["default"],null)},{key:3,title:"Documentation",content:_react2["default"].createElement("div",null,_react2["default"].createElement("h3",null,"What is an API?"),_react2["default"].createElement("p",null,"API stands for application programming interface, which usually involves a set of processes and commands that make it convenient for people to access computer code or information that someone has already produced. For instance, if you want to make your own app post a message to Facebook, you would probably use Facebook’s API to integrate your app with theirs."),_react2["default"].createElement("h3",null,"What is a Database?"),_react2["default"].createElement("p",null,"A database is an organized collection of data. For the Okavango Wildlife Database, each type of data — a wildlife sighting, image, sensor reading or audio recording, to name a few — is uploaded to an online server via satellite. As the expedition unfolds, the database will grow, holding more and more records of what the explorers and scientists have witnessed on the trip."),_react2["default"].createElement("h3",null,"What is a Database API?"),_react2["default"].createElement("p",null,"The Okavango Database API is the interface that allows you to ask the database to show you what’s inside. Usually, API’s are software-to-software interfaces that aren’t that easy for humans to understand. To ask the database to give you data back, you make a specific query in the form of a URL. The database is able to parse and recognize this request, and returns the data to you in some kind of structured way, like an XML or JSON file. In our case, the Okavango Database returns information in JSON (Javascript Object Notation)."),_react2["default"].createElement("h3",null,"Calling the API"),_react2["default"].createElement("p",null,"Basically, it's like this: ",_react2["default"].createElement("code",null,"/api/<view>/<output>?<query>")),_react2["default"].createElement("p",null,"The view is what kind of thing you want back. The core of the API lies in the features view, but you can also view expeditions, members and species as general lists."),_react2["default"].createElement("p",null,"The output returns the data as JSON if nothing is specified, otherwise you can specify ",_react2["default"].createElement("code",null,"map")," to see the data plotted spatially or ",_react2["default"].createElement("code",null,"viz")," for a graph."),_react2["default"].createElement("p",null,"The query defines the filter (ex: ",_react2["default"].createElement("code",null,"FeatureType=sighting"),"). Multiple filters are appended with ",_react2["default"].createElement("code",null,"&")," in between."),_react2["default"].createElement("h3",null,"API Endpoints"),_react2["default"].createElement("p",null,"The following list outlines all possible methods for accessing features in the Okavango Database. These methods are also known as endpoints, and are requested with a URL. For example, to load all of the elephant sightings (limited to the first 100 by default), you would request: ",_react2["default"].createElement("code",null,_react2["default"].createElement("a",{href:"http://intotheokavango.org/api/features?FeatureType=sighting&SpeciesName=Elephant",target:"_blank"},"http://intotheokavango.org/api/features?FeatureType=sighting&SpeciesName=Elephant"))),_react2["default"].createElement("p",null,"The Elephant sightings could be filtered further, by the expedition member who saw them, geographic region, or day of expedition, for example. Each API endpoint call contains the following general information:"),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"limit:")," the amount of entries returned. The default limit is 100, but this can be changed (ex: ",_react2["default"].createElement("code",null,"limit=30"),"). Larger limits tax the database, so it is recommended to keep your limit request as small as possible."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"resolution:")," returns a feature for every ",_react2["default"].createElement("code",null,"resolution")," seconds. This might be useful if you want a larger sample set or time period, but don’t want to overload a graph with every single data point. ",_react2["default"].createElement("code",null,"full")," returns all features."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"filter:")," feature endpoints can be filtered by member, expedition, as well as general filters like ",_react2["default"].createElement("code",null,"limit, resolution,")," and ",_react2["default"].createElement("code",null,"order.")),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"returned:")," the amount of entries returned (this usually correlates to limit, but may be less than the limit indicated if there are fewer results in the database)."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"order:")," results are returned by default in ascending order (indicated by setting ",_react2["default"].createElement("code",null,"order")," to ",_react2["default"].createElement("code",null,"ascending")," or ",_react2["default"].createElement("code",null,"1"),"), or descending order (indicated by setting ",_react2["default"].createElement("code",null,"order")," to ",_react2["default"].createElement("code",null,"descending")," or ",_react2["default"].createElement("code",null,"-1"),")."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"total:")," indicates the total amount of matching results for the query in the database, even if the amount returned is limited."),_react2["default"].createElement("h4",null,"Additional Filters:"),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"startDate:")," specifies the starting date of the features to be returned. May be combined with ",_react2["default"].createElement("code",null,"endDate.")," Format is ",_react2["default"].createElement("code",null,"yyyy-mm-dd")," (ex: ",_react2["default"].createElement("code",null,"startDate=2015-06-03"),")."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"endDate:")," specifies the ending date of the features to be returned. May be combined with ",_react2["default"].createElement("code",null,"startDate.")," Format is ",_react2["default"].createElement("code",null,"yyyy-mm-dd")," (ex: ",_react2["default"].createElement("code",null,"endDate=2015-06-03"),")."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"geoBounds:")," upper left (NW), lower right (SE): lon_1,lat_1,lon_2,lat_2. So the Okavango Delta is something like ",_react2["default"].createElement("code",null,"geoBounds=20,-17,26,-22")),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"expeditionDay:")," returns data from a specific day of the expedition (ex: ",_react2["default"].createElement("code",null,"expeditionDay=1"),")"),_react2["default"].createElement("h4",null,"View Endpoints:"),_react2["default"].createElement("p",null,"These endpoints offer overviews of all the members, expeditions and species that could be used to further filter features in the database."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"members:")," reveals an array of features associated with each member. Endpoint url: ",_react2["default"].createElement("code",null,_react2["default"].createElement("a",{
href:"http://intotheokavango.org/api/members",target:"_blank"},"http://intotheokavango.org/api/members"))),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"expeditions:")," reveals all of the expeditions to the Okavango Delta, along with start date and duration. Endpoint url: ",_react2["default"].createElement("code",null,_react2["default"].createElement("a",{href:"http://intotheokavango.org/api/expeditions",target:"_blank"},"http://intotheokavango.org/api/expeditions"))),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"species:")," reveals all of the species sightings on the expeditions. Endpoint url: ",_react2["default"].createElement("code",null,_react2["default"].createElement("a",{href:"http://intotheokavango.org/api/species",target:"_blank"},"http://intotheokavango.org/api/species"))),_react2["default"].createElement("h4",null,"Features Endpoints:"),_react2["default"].createElement("p",null,"If you try to call the features view, the format looks quite different from the other view endpoints. This is because the Features view contains the bulk of what’s in the database, and is the main collection to be searched and filtered."),_react2["default"].createElement("p",null,"The primary way to filter the features is by ",_react2["default"].createElement("code",null,"FeatureType")," (ex: ",_react2["default"].createElement("code",null,"FeatureType=ambit"),")."),_react2["default"].createElement("p",null,"Here is a list of the possible FeatureTypes, and the data they contain: "),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"ambit:")," contains heart rate and other activity data captured from ambit watches worn by certain explorers."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"ambit_geo:")," contains geolocation data from the ambit watches."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"audio:")," audio recordings taken in the field."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"beacon:")," geolocation data sent by beacons every 30 minutes."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"image:")," all images uploaded to the database. These can be filtered further by ",_react2["default"].createElement("code",null,"ImageType: GoPro, Documentary")," or ",_react2["default"].createElement("code",null,"Specimen.")),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"sensor:")," sensor readings taken by environmental sensors attached to the expedition boat. Data includes temperature, pH levels and other environmental readings."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"sighting:")," all species sightings on the expedition. You can further filter by ",_react2["default"].createElement("code",null,"SpeciesName")," (ex: ",_react2["default"].createElement("code",null,"SpeciesName=Elephant"),"). The results return a timestamped geolocated point, with a ",_react2["default"].createElement("code",null,"Count")," of how many species were sighted, as well as images if they were taken. A ",_react2["default"].createElement("code",null,"Taxonomy")," object returns the scientific name, and a ",_react2["default"].createElement("code",null,"Notes")," field records a description uploaded with the sighting."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"tweet:")," a list of all tweets with the hashtag #okavango15."),_react2["default"].createElement("p",null,_react2["default"].createElement("code",null,"longform:")," returns longform blog entries posted to the okavango collection on ",_react2["default"].createElement("a",{href:"https://medium.com/tag/okavango15",target:"_blank"},"Medium.")))}],index=sections.map(function(section){return _react2["default"].createElement("h3",{key:section.key},section.key," - ",section.title)}),content=sections.map(function(section){return _react2["default"].createElement("div",{key:section.key},_react2["default"].createElement("h2",null,section.key," - ",section.title),section.content)});return _react2["default"].createElement("div",{className:"page",id:"dataPage"},_react2["default"].createElement(_DataPageIndex2["default"],null,index),_react2["default"].createElement("div",{id:"dataPageContent"},content))};DataPage.propTypes={},exports["default"]=DataPage},436:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),DataPageIndex=function(_ref){var children=_ref.children;return _react2["default"].createElement("div",{id:"APIIndex"},children)};DataPageIndex.propTypes={children:_react.PropTypes.node.isRequired},exports["default"]=DataPageIndex},437:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_utils=__webpack_require__(172),DateSelector=function(_ref){var expeditions=_ref.expeditions,expeditionID=_ref.expeditionID,currentDate=_ref.currentDate,expedition=expeditions[expeditionID],dayCount=Math.floor((currentDate.getTime()-expedition.start.getTime())/864e5),dateString=(0,_utils.dateToString)(currentDate);return _react2["default"].createElement("div",{className:"dateSelector controlSelector"},_react2["default"].createElement("p",null,"DAY ",dayCount,_react2["default"].createElement("br",null),dateString))};DateSelector.propTypes={expeditions:_react.PropTypes.object.isRequired,expeditionID:_react.PropTypes.string.isRequired,currentDate:_react.PropTypes.object.isRequired},exports["default"]=DateSelector},438:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}Object.defineProperty(exports,"__esModule",{value:!0});var _class,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_Post=__webpack_require__(247),_Post2=_interopRequireDefault(_Post),_d=__webpack_require__(90),_autobindDecorator=(_interopRequireWildcard(_d),__webpack_require__(46)),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),Feed=(_class=function(_React$Component){function Feed(props){return _classCallCheck(this,Feed),_possibleConstructorReturn(this,Object.getPrototypeOf(Feed).call(this,props))}return _inherits(Feed,_React$Component),_createClass(Feed,[{key:"aga",value:function(){console.log("aga scroll!")}},{key:"render",value:function(){var _props=this.props,posts=_props.posts,checkFeedContent=_props.checkFeedContent,format="full",postFeed=posts.slice(0).sort(function(a,b){return b.date-a.date}).map(function(post){return _react2["default"].createElement(_Post2["default"],{format:format,data:post,key:post.key},post.content)});return _react2["default"].createElement("div",{id:"feed",onWheel:checkFeedContent},postFeed)}}]),Feed}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"aga",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"aga"),_class.prototype),_class);Feed.propTypes={posts:_react.PropTypes.array.isRequired,expedition:_react.PropTypes.object,checkFeedContent:_react.PropTypes.func.isRequired},exports["default"]=Feed},439:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),FocusSelector=function(_ref){var mainFocus=_ref.mainFocus,secondaryFocus=_ref.secondaryFocus,onMainFocusChange=_ref.onMainFocusChange,onSecondaryFocusChange=_ref.onSecondaryFocusChange,toggleDropdown=function(i){document.getElementById("FocusSelector"+i+"Options").classList.toggle("show")};return _react2["default"].createElement("div",{className:"focusSelector controlSelector"},_react2["default"].createElement("p",null,"Focus on:"),_react2["default"].createElement("div",{className:"dropdown"},_react2["default"].createElement("button",{onClick:function(){return toggleDropdown(1)},className:"dropbtn"},mainFocus),_react2["default"].createElement("div",{id:"FocusSelector1Options",className:"dropdown-content"},_react2["default"].createElement("a",{href:"#",onClick:function(){return onMainFocusChange("explorers")}},"Explorers"),_react2["default"].createElement("a",{href:"#",onClick:function(){return onMainFocusChange("sensors")}},"Sensors"),_react2["default"].createElement("a",{href:"#",onClick:function(){return onMainFocusChange("animals")}},"Animals"))),_react2["default"].createElement("div",{className:"dropdown"},_react2["default"].createElement("button",{onClick:function(){return toggleDropdown(2)},className:"dropbtn"},secondaryFocus),_react2["default"].createElement("div",{id:"FocusSelector2Options",className:"dropdown-content"},_react2["default"].createElement("a",{href:"#",onClick:function(){return onSecondaryFocusChange("steve")}},"Steve"),_react2["default"].createElement("a",{href:"#",onClick:function(){return onSecondaryFocusChange("jer")}},"Jer"),_react2["default"].createElement("a",{href:"#",onClick:function(){return onSecondaryFocusChange("shah")}},"Shah"),_react2["default"].createElement("a",{href:"#",onClick:function(){return onSecondaryFocusChange("chris")}},"Chris"))))};FocusSelector.propTypes={mainFocus:_react.PropTypes.string.isRequired,secondaryFocus:_react.PropTypes.string.isRequired,onMainFocusChange:_react.PropTypes.func.isRequired,onSecondaryFocusChange:_react.PropTypes.func.isRequired},exports["default"]=FocusSelector},440:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}Object.defineProperty(exports,"__esModule",{value:!0});var _class,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_reactAddonsCssTransitionGroup=__webpack_require__(372),_reactAddonsCssTransitionGroup2=_interopRequireDefault(_reactAddonsCssTransitionGroup),_autobindDecorator=__webpack_require__(46),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),IntroductionBox=(_class=function(_React$Component){function IntroductionBox(props){_classCallCheck(this,IntroductionBox);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(IntroductionBox).call(this,props));return _this.state={complete:!1,contentEnabled:!1,startDate:0,currentPosts:[],posts:[{content:_react2["default"].createElement("p",{key:"0"},"The Okavango Delta is one of the world’s last great wetland wildernesses."),timeRange:[0,6e3]},{content:_react2["default"].createElement("p",{key:"1"},"A team of Ba’Yei, scientists, engineers and adventurers is journeying a 345 kilometers crossing the delta, finding new species and exploring new ground."),timeRange:[6e3,13e3]},{content:_react2["default"].createElement("p",{key:"2"},"Join us in real-time as we explore",_react2["default"].createElement("br",null),_react2["default"].createElement("span",null,"the beating heart of our planet.")),timeRange:[13e3,21e3]}]},_this}return _inherits(IntroductionBox,_React$Component),_createClass(IntroductionBox,[{key:"skip",value:function(){var enableContent=this.props.enableContent;this.state.complete=!0,this.state.contentEnabled=!0,enableContent()}},{key:"tick",value:function(){var enableContent=this.props.enableContent,_state=this.state,posts=_state.posts,startDate=_state.startDate;if("/"!==location.pathname&&"/map"!==location.pathname)return void(this.state.complete=!0);var now=Date.now()-startDate,currentPosts=[];posts.forEach(function(p){p.timeRange[0]<=now&&p.timeRange[1]>now&&currentPosts.push(p)}),now>posts[posts.length-1].timeRange[1]-6e3&&!this.state.contentEnabled&&(this.state.contentEnabled=!0,enableContent());var flag=!0;if(currentPosts.length!==this.state.currentPosts.length)flag=!1;else for(var i=0;i<Math.max(currentPosts.length,this.state.currentPosts.length);i++)if(currentPosts[i]!==this.state.currentPosts[i]){flag=!1;break}return flag||this.setState(_extends({},this.state,{currentPosts:currentPosts})),now>posts[posts.length-1].timeRange[1]?void(this.state.complete=!0):void requestAnimationFrame(this.tick)}},{key:"componentDidMount",value:function(){this.setState(_extends({},this.state,{startDate:Date.now()})),requestAnimationFrame(this.tick)}},{key:"render",value:function(){var _state2=this.state,currentPosts=_state2.currentPosts,complete=_state2.complete,animate=this.props.animate,posts=currentPosts.map(function(p){return p.content}),container=function(){return _react2["default"].createElement(_reactAddonsCssTransitionGroup2["default"],{transitionName:"notif",transitionEnterTimeout:500,transitionLeaveTimeout:200},posts)};return complete||!animate?_react2["default"].createElement("div",null):_react2["default"].createElement("div",{id:"IntroductionBox"},container(),_react2["default"].createElement("div",{id:"skip-button",onClick:this.skip},"SKIP"))}}]),IntroductionBox}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"skip",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"skip"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"tick",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"tick"),_class.prototype),_class);IntroductionBox.propTypes={enableContent:_react.PropTypes.func.isRequired,animate:_react.PropTypes.bool.isRequired},exports["default"]=IntroductionBox},441:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_Feed=__webpack_require__(438),_Feed2=_interopRequireDefault(_Feed),_ControlPanelContainer=__webpack_require__(248),_ControlPanelContainer2=_interopRequireDefault(_ControlPanelContainer),JournalPage=function(_React$Component){function JournalPage(){return _classCallCheck(this,JournalPage),_possibleConstructorReturn(this,Object.getPrototypeOf(JournalPage).apply(this,arguments))}return _inherits(JournalPage,_React$Component),_createClass(JournalPage,[{key:"render",value:function(){var _props=this.props,posts=_props.posts,checkFeedContent=_props.checkFeedContent,expedition=_props.expedition;return _react2["default"].createElement("div",{className:"page",id:"journalPage"},_react2["default"].createElement(_ControlPanelContainer2["default"],{pathName:location.pathname}),_react2["default"].createElement(_Feed2["default"],{posts:posts,checkFeedContent:checkFeedContent,expedition:expedition}))}}]),JournalPage}(_react2["default"].Component);JournalPage.propTypes={posts:_react.PropTypes.array.isRequired,expedition:_react.PropTypes.object,checkFeedContent:_react.PropTypes.func.isRequired},exports["default"]=JournalPage},442:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),LayoutSelector=function(_ref){var mode=_ref.mode,onLayoutChange=_ref.onLayoutChange,types=["rows","grid"],buttons=types.map(function(s,i){var className="layoutButton "+(s===mode?"active":"inactive");return _react2["default"].createElement("li",{className:className,key:i,onClick:function(){return onLayoutChange(s)}},_react2["default"].createElement("img",{width:"16",height:"16"}))});return _react2["default"].createElement("div",{className:"selector"},_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("ul",{className:"buttonRow"},buttons)))};LayoutSelector.propTypes={onLayoutChange:_react.PropTypes.func.isRequired,mode:_react.PropTypes.string.isRequired},exports["default"]=LayoutSelector},443:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_Post=__webpack_require__(247),_Post2=_interopRequireDefault(_Post),LightBox=function(_ref){var active=_ref.active,height={height:window.innerHeight-200},post={key:1,type:"tweet",content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum ultricies facilisis ipsum, non sagittis velit venenatis gravida.",date:Date.now(),location:[0,0],link:"http://www.google.com",image:"../static/img/photo.png"},meta={type:post.type,date:post.date,location:post.location,link:post.link};return active?_react2["default"].createElement("div",{id:"lightBox"},_react2["default"].createElement("div",{className:"contentWrapper",style:height},_react2["default"].createElement(_Post2["default"],{format:"lightBox",meta:meta},post.image))):null};LightBox.propTypes={active:_react.PropTypes.bool.isRequired},exports["default"]=LightBox},444:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_NotificationPanelContainer=__webpack_require__(457),_NotificationPanelContainer2=_interopRequireDefault(_NotificationPanelContainer),_ControlPanelContainer=__webpack_require__(248),_ControlPanelContainer2=_interopRequireDefault(_ControlPanelContainer),MapPage=function(){var height={height:window.innerWidth>768?window.innerHeight-100:window.innerHeight-120};return _react2["default"].createElement("div",{className:"page",id:"mapPage",style:height},_react2["default"].createElement(_ControlPanelContainer2["default"],{pathName:location.pathname}),_react2["default"].createElement(_NotificationPanelContainer2["default"],null))};exports["default"]=MapPage},445:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_NavigationItem=__webpack_require__(446),_NavigationItem2=_interopRequireDefault(_NavigationItem),Navigation=function(_ref){var pathName=_ref.pathName,setPage=_ref.setPage;return _react2["default"].createElement("div",{id:"header"},_react2["default"].createElement("div",{id:"navigation"},_react2["default"].createElement("ul",null,_react2["default"].createElement(_NavigationItem2["default"],{setPage:setPage,active:"/"===pathName||"/map"===pathName},"Map"),_react2["default"].createElement(_NavigationItem2["default"],{setPage:setPage,active:"/journal"===pathName},"Journal"),_react2["default"].createElement(_NavigationItem2["default"],{setPage:setPage,active:"/data"===pathName},"Data"),_react2["default"].createElement(_NavigationItem2["default"],{setPage:setPage,active:"/about"===pathName},"About"))),_react2["default"].createElement("h1",null,"INTO THE OKAVANGO"),_react2["default"].createElement("img",{id:"logo",src:"static/img/logo.svg",alt:"Into the Okavango"}))};Navigation.propTypes={pathName:_react.PropTypes.string.isRequired,setPage:_react.PropTypes.func.isRequired},exports["default"]=Navigation},446:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_reactRouter=__webpack_require__(382),NavigationItem=function(_ref){var children=_ref.children,active=_ref.active,setPage=_ref.setPage;return setPage||(setPage=function(){}),_react2["default"].createElement("li",{className:active?"active":"",onClick:setPage},_react2["default"].createElement(_reactRouter.Link,{to:children.toString().toLowerCase()},children.toString()))};NavigationItem.propTypes={children:_react.PropTypes.node.isRequired,setPage:_react.PropTypes.func},exports["default"]=NavigationItem},447:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),Notification=function(_ref){var children=_ref.children,type=_ref.type;return _react2["default"].createElement("div",{className:"notification"},_react2["default"].createElement("div",{className:"content"},children),_react2["default"].createElement("div",{className:"type"},_react2["default"].createElement("img",{width:"16",height:"16",src:"static/img/icon-"+type+".png"})))};Notification.propTypes={children:_react.PropTypes.node.isRequired,type:_react.PropTypes.string.isRequired},exports["default"]=Notification},448:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_Notification=__webpack_require__(447),_Notification2=_interopRequireDefault(_Notification),_reactAddonsCssTransitionGroup=__webpack_require__(372),_reactAddonsCssTransitionGroup2=_interopRequireDefault(_reactAddonsCssTransitionGroup),NotificationPanel=function(_ref){var start,end,posts=_ref.posts,currentDate=_ref.currentDate;currentDate&&(start=new Date(currentDate.getTime()-18e5),end=new Date(currentDate.getTime()+18e5)),posts||(posts=[]);var notificationItems=posts.filter(function(post){var d=new Date(post.properties.DateTime);return d.getTime()>=start&&d.getTime()<end});notificationItems=notificationItems.filter(function(post,i){return window.innerWidth>768||i===notificationItems.length-1}).sort(function(a,b){return new Date(a.properties.DateTime).getTime()-new Date(b.properties.DateTime).getTime()}).map(function(post,i){switch(post.type){case"tweet":var text=post.properties.Text;text=text.split(" ").slice(0,text.split(" ").length-1).join(" "),post.properties.Tweet&&(text=post.properties.Tweet.text);var images=post.properties.Images.filter(function(img,j){return 0===j}).map(function(img,j){return _react2["default"].createElement("img",{src:img.Url.replace("http://","https://"),width:"100%",key:j})});return _react2["default"].createElement(_Notification2["default"],{type:post.type,key:post.id},_react2["default"].createElement("p",{style:{position:window.innerWidth>768||0===post.properties.Images.length?"relative":"absolute"}},text),_react2["default"].createElement("div",{className:"images"},images));case"audio":return _react2["default"].createElement(_Notification2["default"],{type:post.type,key:post.id},_react2["default"].createElement("div",{className:"title"},post.properties.Title));case"blog":return _react2["default"].createElement(_Notification2["default"],{type:post.type,key:post.id},_react2["default"].createElement("div",{className:"title"},post.properties.Title));case"image":var width=0,height=0;return post.properties.Dimensions?(width=post.properties.Dimensions[0],height=post.properties.Dimensions[1]):post.properties.Size&&(width=post.properties.Size[0],height=post.properties.Size[1]),_react2["default"].createElement(_Notification2["default"],{type:post.type,key:post.id},_react2["default"].createElement("img",{className:"image",src:post.properties.Url.replace("http://","https://"),width:width,height:height}))}});var height=window.innerWidth>768?{height:window.innerHeight-100}:{};return _react2["default"].createElement("div",{id:"notificationPanel",style:height},_react2["default"].createElement(_reactAddonsCssTransitionGroup2["default"],{transitionName:"notif",transitionEnterTimeout:300,transitionLeaveTimeout:150},notificationItems))};NotificationPanel.propTypes={posts:_react.PropTypes.array,currentDate:_react.PropTypes.object},exports["default"]=NotificationPanel},449:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_BackgroundMap=__webpack_require__(433),_BackgroundMap2=_interopRequireDefault(_BackgroundMap),_LightBox=__webpack_require__(443),_LightBox2=_interopRequireDefault(_LightBox),_Timeline=__webpack_require__(453),_Timeline2=_interopRequireDefault(_Timeline),_Navigation=__webpack_require__(445),_Navigation2=_interopRequireDefault(_Navigation),_IntroductionBox=__webpack_require__(440),_IntroductionBox2=_interopRequireDefault(_IntroductionBox),Okavango=function(_React$Component){function Okavango(){
return _classCallCheck(this,Okavango),_possibleConstructorReturn(this,Object.getPrototypeOf(Okavango).apply(this,arguments))}return _inherits(Okavango,_React$Component),_createClass(Okavango,[{key:"render",value:function(){var _props=this.props,children=_props.children,expedition=_props.expedition,animate=_props.animate,updateMap=_props.updateMap,fetchDay=_props.fetchDay,setControl=_props.setControl,jumpTo=_props.jumpTo,isFetching=_props.isFetching,mapStateNeedsUpdate=_props.mapStateNeedsUpdate,setPage=_props.setPage,expeditionID=_props.expeditionID,contentActive=_props.contentActive,enableContent=_props.enableContent,initialPage=_props.initialPage,height={height:window.innerWidth>768?window.innerHeight-100:window.innerHeight-120};return _react2["default"].createElement("div",{id:"root"},_react2["default"].createElement(_BackgroundMap2["default"],{initialPage:initialPage,expeditionID:expeditionID,isFetching:isFetching,animate:animate,expedition:expedition,updateMap:updateMap,fetchDay:fetchDay,setControl:setControl,mapStateNeedsUpdate:mapStateNeedsUpdate,contentActive:contentActive}),_react2["default"].createElement("div",{id:"nightOverlay",style:{opacity:"/map"===location.pathname||"/"===location.pathname?0:1}}),_react2["default"].createElement(_Navigation2["default"],{setPage:setPage,pathName:location.pathname}),_react2["default"].createElement("div",{id:"content",style:height,className:contentActive?"":"hidden"},isFetching?_react2["default"].createElement("div",{id:"loadingWheel"},_react2["default"].createElement("div",{className:"wheel"})):null,_react2["default"].createElement(_LightBox2["default"],{active:!1}),_react2["default"].createElement(_Timeline2["default"],{expeditionID:expeditionID,expedition:expedition,jumpTo:jumpTo}),_react2["default"].createElement("div",{id:"pageContainer"},children),_react2["default"].createElement("div",{className:"logos",style:{display:"/map"===location.pathname||"/"===location.pathname?"block":"none"}},_react2["default"].createElement("a",{href:"http://www.nationalgeographic.com/"},_react2["default"].createElement("img",{src:"static/img/natgeoLogo.svg",alt:"National Geographic Logo",height:"35px"})),_react2["default"].createElement("a",{href:"http://conservify.org/"},_react2["default"].createElement("img",{src:"static/img/conservify.png",alt:"Conservify Logo",height:"35px"})),_react2["default"].createElement("a",{href:"http://www.o-c-r.org/"},_react2["default"].createElement("img",{src:"static/img/ocrLogo.svg",alt:"The Office for Creative Research Logo",height:"35px"})),_react2["default"].createElement("a",{href:"http://www.wildbirdtrust.com/"},_react2["default"].createElement("img",{src:"static/img/wbtLogo.png",alt:"Wild Bird Trust Logo",height:"35px"})))),_react2["default"].createElement(_IntroductionBox2["default"],{enableContent:enableContent,animate:animate}))}}]),Okavango}(_react2["default"].Component);exports["default"]=Okavango,Okavango.propTypes={animate:_react.PropTypes.bool,children:_react.PropTypes.node.isRequired,expedition:_react.PropTypes.object,expeditionID:_react.PropTypes.string,updateMap:_react.PropTypes.func.isRequired,fetchDay:_react.PropTypes.func.isRequired,setControl:_react.PropTypes.func.isRequired,jumpTo:_react.PropTypes.func.isRequired,isFetching:_react.PropTypes.bool.isRequired,mapStateNeedsUpdate:_react.PropTypes.bool.isRequired,setPage:_react.PropTypes.func.isRequired,contentActive:_react.PropTypes.bool.isRequired,enableContent:_react.PropTypes.func.isRequired,initialPage:_react.PropTypes.string.isRequired}},450:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}Object.defineProperty(exports,"__esModule",{value:!0});var _class,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_autobindDecorator=__webpack_require__(46),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),PlaybackSelector=(_class=function(_React$Component){function PlaybackSelector(props){_classCallCheck(this,PlaybackSelector);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(PlaybackSelector).call(this,props));return _this.state={mouseOver:""},_this}return _inherits(PlaybackSelector,_React$Component),_createClass(PlaybackSelector,[{key:"onMouseMove",value:function(e){this.setState(_extends({},this.state,{mouseOver:e.nativeEvent.target.className}))}},{key:"onMouseOut",value:function(e){this.setState(_extends({},this.state,{mouseOver:""}))}},{key:"render",value:function(){var _props=this.props,mode=_props.mode,onPlaybackChange=_props.onPlaybackChange,mouseOver=this.state.mouseOver,onMouseMove=this.onMouseMove,types=["fastBackward","backward","pause","forward","fastForward"],buttons=types.map(function(s,i){var className="playbackButton "+(s===mode?"active":"inactive"),src=function(){var url="/static/img/icon-"+s;return s!==mode&&mouseOver!==s||(url+="-hover"),url+".png"};return _react2["default"].createElement("li",{className:className,key:i,onClick:function(){return onPlaybackChange(s)},onMouseMove:onMouseMove},_react2["default"].createElement("img",{className:s,width:"16",height:"16",src:src()}))});return _react2["default"].createElement("ul",{className:"playbackSelector buttonRow controlSelector",onMouseOut:this.onMouseOut},buttons)}}]),PlaybackSelector}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"onMouseMove",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"onMouseMove"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"onMouseOut",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"onMouseOut"),_class.prototype),_class);PlaybackSelector.propTypes={mode:_react.PropTypes.string.isRequired,onPlaybackChange:_react.PropTypes.func.isRequired},exports["default"]=PlaybackSelector},451:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),SharePage=function(){return _react2["default"].createElement("div",{className:"page",id:"sharePage"},"Share page")};SharePage.propTypes={},exports["default"]=SharePage},452:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_d=__webpack_require__(90),d3=_interopRequireWildcard(_d),SightingGraph=function(_ref){var width=_ref.width,height=_ref.height,sightings=_ref.sightings,margin=.42;width-=margin*width;var x=d3.scaleLinear().domain([0,d3.max(sightings)]).range([width,width*margin]),y=d3.scaleLinear().domain([0,sightings.length-1]).range([0,height]);return _react2["default"].createElement("g",null,_react2["default"].createElement("path",{fill:"rgba(196,131,39,0.8)",d:d3.area().x0(width).x1(function(d){return x(d)}).y(function(d,i){return y(i)})(sightings)}))};SightingGraph.propTypes={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,sightings:_react.PropTypes.array},exports["default"]=SightingGraph},453:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}Object.defineProperty(exports,"__esModule",{value:!0});var _class,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_d=__webpack_require__(90),d3=_interopRequireWildcard(_d),_autobindDecorator=__webpack_require__(46),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),_SightingGraph=__webpack_require__(452),_SightingGraph2=_interopRequireDefault(_SightingGraph),Timeline=(_class=function(_React$Component){function Timeline(props){_classCallCheck(this,Timeline);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Timeline).call(this,props));return _this.state={padding:[2,8],x:0,cursorY:0,width:0,height:0,data:[],range:[0,0],domain:[0,0],scaleDays:null,scaleTime:null,totalSightings:[],mouseOver:!1},_this}return _inherits(Timeline,_React$Component),_createClass(Timeline,[{key:"componentWillReceiveProps",value:function(nextProps){var expedition=nextProps.expedition;if(expedition){for(var padding=this.state.padding,startDate=expedition.start,height=window.innerHeight-72,width=.05*window.innerWidth,x=.58*width,dayCount=expedition.dayCount+1,data=[],i=0;i<dayCount;i++){var d=new Date(startDate.getTime()+864e5*i);data.push(d)}var range=[0+padding[1],height-padding[1]],domain=[dayCount-1,0],scaleDays=d3.scaleLinear().domain(domain).range(range),scaleTime=d3.scaleLinear().domain([startDate.getTime()+864e5*(dayCount-1),startDate.getTime()]).range(range),cursorY=this.state.mouseOver?this.state.cursorY:scaleTime(expedition.currentDate.getTime())-8,totalSightings=expedition.totalSightings;this.setState(_extends({},this.state,{x:x,cursorY:cursorY,width:width,height:height,data:data,range:range,domain:domain,scaleDays:scaleDays,scaleTime:scaleTime,totalSightings:totalSightings}))}}},{key:"onClick",value:function(e){var _state=this.state,scaleTime=_state.scaleTime,range=_state.range,_props=this.props,jumpTo=_props.jumpTo,expeditionID=_props.expeditionID,y=e.nativeEvent.offsetY;jumpTo(new Date(scaleTime.invert(Math.max(range[0]+1,Math.min(range[1]-1,y)))),expeditionID)}},{key:"onMouseMove",value:function(e){var _state2=this.state,range=_state2.range,padding=_state2.padding,cursorY=Math.max(range[0],Math.min(range[1],e.nativeEvent.offsetY))-padding[1];this.setState(_extends({},this.state,{cursorY:cursorY,mouseOver:!0}))}},{key:"onMouseOut",value:function(e){var expedition=this.props.expedition,scaleTime=this.state.scaleTime,cursorY=scaleTime(expedition.currentDate.getTime())-8;this.setState(_extends({},this.state,{cursorY:cursorY,mouseOver:!1}))}},{key:"render",value:function(){var expedition=this.props.expedition;if(!expedition)return _react2["default"].createElement("svg",{id:"timeline"});var _state3=this.state,width=_state3.width,height=_state3.height,data=_state3.data,x=_state3.x,range=_state3.range,scaleDays=_state3.scaleDays,cursorY=_state3.cursorY,totalSightings=_state3.totalSightings,padding=_state3.padding,days=data.map(function(d,i){return _react2["default"].createElement("circle",{cx:x,cy:scaleDays(i),r:3,key:i,fill:"white"})});return _react2["default"].createElement("svg",{id:"timeline",className:"/data"===location.pathname||"/about"===location.pathname?"invisible":"visible",style:{height:height+"px"},onMouseOut:this.onMouseOut,onMouseMove:this.onMouseMove,onClick:this.onClick},_react2["default"].createElement("filter",{id:"dropshadow",height:"120%"},_react2["default"].createElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:"3"}),_react2["default"].createElement("feOffset",{dx:"2",dy:"0",result:"offsetblur"}),_react2["default"].createElement("feMerge",null,_react2["default"].createElement("feMergeNode",null),_react2["default"].createElement("feMergeNode",{"in":"SourceGraphic"}))),_react2["default"].createElement("g",{transform:"translate(0,"+padding[1]+")",style:{pointerEvents:"none"}},_react2["default"].createElement(_SightingGraph2["default"],{sightings:totalSightings,width:width,height:height-2*padding[1]})),_react2["default"].createElement("line",{x1:x,x2:x,y1:range[0],y2:range[1],style:{stroke:"white"}}),_react2["default"].createElement("g",null,days),_react2["default"].createElement("g",{transform:"translate("+(x-20)+","+cursorY+")",style:{pointerEvents:"none"}},_react2["default"].createElement("path",{fill:"#F9D144",d:"M8,0c5,0,12,8,12,8s-7,8-12,8c-4.4,0-8-3.6-8-8C0,3.6,3.6,0,8,0z",style:{filter:"url(#dropshadow)"}}),_react2["default"].createElement("circle",{fill:"#1F1426",cx:"7.9",cy:"7.8",r:"3"})))}}]),Timeline}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"onClick",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"onClick"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"onMouseMove",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"onMouseMove"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"onMouseOut",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"onMouseOut"),_class.prototype),_class);Timeline.propTypes={expedition:_react.PropTypes.object,jumpTo:_react.PropTypes.func.isRequired,expeditionID:_react.PropTypes.string},exports["default"]=Timeline},454:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),YearSelector=function(_ref){var expeditionID=_ref.expeditionID,expeditions=_ref.expeditions,onYearChange=_ref.onYearChange,toggleDropdown=function(){document.getElementById("YearSelectorDropdown").classList.toggle("show")},currentExpeditionName=expeditions[expeditionID].name,expeditionList=Object.keys(expeditions).sort(function(a,b){return expeditions[b].end.getTime()-expeditions[a].end.getTime()}).map(function(k,i){var expedition=expeditions[k];return _react2["default"].createElement("a",{href:"#",onClick:function(){return onYearChange(k)},key:i},expedition.name)});return _react2["default"].createElement("div",{className:"dropdown yearSelector controlSelector"},_react2["default"].createElement("button",{onClick:toggleDropdown,className:"dropbtn"},currentExpeditionName,_react2["default"].createElement("span",null)),_react2["default"].createElement("div",{id:"YearSelectorDropdown",className:"dropdown-content"},expeditionList))};YearSelector.propTypes={onYearChange:_react.PropTypes.func.isRequired,expeditionID:_react.PropTypes.string.isRequired,expeditions:_react.PropTypes.object.isRequired},exports["default"]=YearSelector},455:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_viewportMercatorProject=__webpack_require__(79),_viewportMercatorProject2=_interopRequireDefault(_viewportMercatorProject),_autobindDecorator=__webpack_require__(46),ZoomSelector=(_interopRequireDefault(_autobindDecorator),function(_React$Component){function ZoomSelector(props){_classCallCheck(this,ZoomSelector);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(ZoomSelector).call(this,props));return _this.state={mouseOver:""},_this}return _inherits(ZoomSelector,_React$Component),_createClass(ZoomSelector,[{key:"render",value:function(){var _props=this.props,onZoomChange=_props.onZoomChange,viewport=_props.viewport,mouseOver=(this.onMouseMove,this.state.mouseOver),types=["decrement","increment"],buttons=types.map(function(s,i){var src=function(){var url="/static/img/icon-"+s;return mouseOver===s&&(url+="-hover"),url+".png"};return _react2["default"].createElement("li",{className:"zoomButton",key:i,onClick:function(){onZoomChange(s)}},_react2["default"].createElement("img",{className:s,width:"16",height:"16",src:src()}))}),_ViewportMercator=(0,_viewportMercatorProject2["default"])(_extends({},viewport)),unproject=_ViewportMercator.unproject,scaleRange=111*(unproject([64,0])[0]-unproject([0,0])[0]),scaleString=Math.round(scaleRange)+"km";return scaleRange<1&&(scaleString=Math.round(1e3*scaleRange)+"m"),_react2["default"].createElement("div",{className:"selector controlSelector"},_react2["default"].createElement("div",{className:"column"},_react2["default"].createElement("ul",{className:"buttonRow"},buttons)),_react2["default"].createElement("svg",{className:"column"},_react2["default"].createElement("line",{x1:0,y1:17.5,x2:12,y2:17.5,stroke:"white"}),_react2["default"].createElement("line",{x1:52,y1:17.5,x2:64,y2:17.5,stroke:"white"}),_react2["default"].createElement("line",{x1:.5,y1:12,x2:.5,y2:22,stroke:"white"}),_react2["default"].createElement("line",{x1:63.5,y1:12,x2:63.5,y2:22,stroke:"white"}),_react2["default"].createElement("text",{x:32,y:18,fill:"white",style:{fontSize:"12px",alignmentBaseline:"middle",textAnchor:"middle"}},scaleString)))}}]),ZoomSelector}(_react2["default"].Component));ZoomSelector.propTypes={onZoomChange:_react.PropTypes.func.isRequired,viewPort:_react.PropTypes.object},exports["default"]=ZoomSelector},456:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _reactRedux=__webpack_require__(134),_JournalPage=__webpack_require__(441),_JournalPage2=_interopRequireDefault(_JournalPage),_actions=__webpack_require__(114),actions=_interopRequireWildcard(_actions),_d=__webpack_require__(90),d3=_interopRequireWildcard(_d),mapStateToProps=function(state,ownProps){var expeditionID=state.selectedExpedition,expedition=state.expeditions[expeditionID];return expedition?{expedition:expedition,posts:d3.values(expedition.features).map(function(p){var title,content,images,link,dimensions,key=p.id,type=p.properties.FeatureType,date=new Date(p.properties.DateTime),location=p.geometry.coordinates,author=p.properties.Member;return"tweet"===type&&("okavango_14"!==expeditionID?(content=p.properties.Text,images=p.properties.Images.map(function(i){return i.Url.replace("http://","https://")}),link=p.properties.Url.replace("http://","https://")):content=p.properties.Tweet.text),"image"===type&&("okavango_14"!==expeditionID?(content=p.properties.Notes,images=[p.properties.Url.replace("http://","https://")],link=p.properties.InstagramID,dimensions=p.properties.Dimensions):(content=p.properties.Notes,images=[p.properties.Url.replace("http://","https://")],link=p.properties.InstagramID,dimensions=p.properties.Size)),"blog"===type&&(title=p.properties.Title,content=p.properties.Summary,link=p.properties.Url.replace("http://","https://")),"audio"===type&&(title=p.properties.Title,link=p.properties.SoundCloudURL.replace("http://","https://")),{key:key,type:type,title:title,content:content,images:images,link:link,date:date,location:location,author:author,dimensions:dimensions}})}:{posts:[]}},mapDispatchToProps=function(dispatch,ownProps){return{checkFeedContent:function(){return dispatch(actions.checkFeedContent())}}},JournalPageContainer=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_JournalPage2["default"]);exports["default"]=JournalPageContainer},457:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _reactRedux=__webpack_require__(134),_NotificationPanel=__webpack_require__(448),_NotificationPanel2=_interopRequireDefault(_NotificationPanel),mapStateToProps=function(state,ownProps){var expedition=state.expeditions[state.selectedExpedition];return expedition?{posts:expedition.currentPosts,currentDate:expedition.currentDate}:{}},mapDispatchToProps=function(dispatch,ownProps){return{}},NotificationPanelContainer=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_NotificationPanel2["default"]);exports["default"]=NotificationPanelContainer},458:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _reactRedux=__webpack_require__(134),_Okavango=__webpack_require__(449),_Okavango2=_interopRequireDefault(_Okavango),_actions=__webpack_require__(114),actions=_interopRequireWildcard(_actions),mapStateToProps=function(state,ownProps){return{expedition:state.expeditions[state.selectedExpedition],children:ownProps.children,animate:state.animate,isFetching:state.isFetching,mapStateNeedsUpdate:state.mapStateNeedsUpdate,expeditionID:state.selectedExpedition,contentActive:state.contentActive,initialPage:state.initialPage}},mapDispatchToProps=function(dispatch,ownProps){return{fetchDay:function(currentDate){return dispatch(actions.fetchDay(currentDate))},updateMap:function(currentDate,coordinates,viewGeoBounds,zoom,expeditionID){return dispatch(actions.updateMap(currentDate,coordinates,viewGeoBounds,zoom,expeditionID))},setControl:function(target,mode){return dispatch(actions.setControl(target,mode))},jumpTo:function(date,expeditionID){return dispatch(actions.jumpTo(date,expeditionID))},setPage:function(){return dispatch(actions.setPage())},enableContent:function(){return dispatch(actions.enableContent())}}},OkavangoContainer=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_Okavango2["default"]);exports["default"]=OkavangoContainer},459:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.DEFAULT_LIGHTING={enable:!0,ambient:{r:1,g:1,b:1},points:[{diffuse:{r:.8,g:.8,b:.8},specular:{r:.6,g:.6,b:.6},position:[.5,.5,3]}]},exports.DEFAULT_BACKGROUND_COLOR={r:0,g:0,b:0,a:0},exports.DEFAULT_BLENDING={enable:!0,blendFunc:["SRC_ALPHA","ONE_MINUS_SRC_ALPHA"],blendEquation:"FUNC_ADD"}},460:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _class,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_autobindDecorator=__webpack_require__(46),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),_webglRenderer=__webpack_require__(479),_webglRenderer2=_interopRequireDefault(_webglRenderer),_luma=__webpack_require__(65),_config=__webpack_require__(459),_layerManager=__webpack_require__(462),_viewport=__webpack_require__(476),_viewport2=_interopRequireDefault(_viewport),DEFAULT_PIXEL_RATIO="undefined"!=typeof window?window.devicePixelRatio:1,PROP_TYPES={width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,layers:_react.PropTypes.array.isRequired,blending:_react.PropTypes.object,gl:_react.PropTypes.object,debug:_react.PropTypes.bool,camera:_react.PropTypes.instanceOf(_luma.Camera),pixelRatio:_react.PropTypes.number,onWebGLInitialized:_react.PropTypes.func},DEFAULT_PROPS={blending:_config.DEFAULT_BLENDING,camera:null,pixelRatio:DEFAULT_PIXEL_RATIO,gl:null,debug:!1,onWebGLInitialized:function(){}},DeckGLOverlay=(_class=function(_React$Component){function DeckGLOverlay(props){_classCallCheck(this,DeckGLOverlay);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(DeckGLOverlay).call(this,props));
return _this.state={},_this.needsRedraw=!0,_this}return _inherits(DeckGLOverlay,_React$Component),_createClass(DeckGLOverlay,null,[{key:"propTypes",get:function(){return PROP_TYPES}},{key:"defaultProps",get:function(){return DEFAULT_PROPS}}]),_createClass(DeckGLOverlay,[{key:"componentWillReceiveProps",value:function(nextProps){var _state=this.state,gl=_state.gl,scene=_state.scene;(0,_layerManager.updateLayers)({oldLayers:this.props.layers,newLayers:nextProps.layers,gl:gl,scene:scene})}},{key:"_onRendererInitialized",value:function(_ref){var gl=_ref.gl;this.props.onWebGLInitialized(gl);var scene=new _luma.Scene(gl,{lights:_config.DEFAULT_LIGHTING,backgroundColor:_config.DEFAULT_BACKGROUND_COLOR});this.setState({gl:gl,scene:scene}),(0,_layerManager.updateLayers)({oldLayers:[],newLayers:this.props.layers,gl:gl,scene:scene})}},{key:"_onClick",value:function(info){var picked=info.picked,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=picked[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;if(item.model.userData.layer.onClick(_extends({color:item.color},info)))return}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"_onMouseMove",value:function(info){var picked=info.picked,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=picked[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var item=_step2.value;if(item.model.userData.layer.onHover(_extends({color:item.color},info)))return}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"_checkIfNeedRedraw",value:function(){var layers=this.props.layers;return(0,_layerManager.layersNeedRedraw)(layers,{clearRedrawFlags:!0})}},{key:"render",value:function(){function convertToMat4(toMatrix,fromMatrix){for(var i=0;i<fromMatrix.length;++i)toMatrix[i]=fromMatrix[i]}var _props=this.props,width=_props.width,height=_props.height,blending=(_props.layers,_props.blending),pixelRatio=_props.pixelRatio,latitude=_props.latitude,longitude=_props.longitude,zoom=_props.zoom,pitch=_props.pitch,bearing=_props.bearing,altitude=_props.altitude,gl=_props.gl,debug=_props.debug,otherProps=_objectWithoutProperties(_props,["width","height","layers","blending","pixelRatio","latitude","longitude","zoom","pitch","bearing","altitude","gl","debug"]),camera=this.props.camera,scene=this.state.scene;if(!camera){var viewport=new _viewport2["default"]({width:width,height:height,latitude:latitude,longitude:longitude,zoom:zoom,pitch:pitch,bearing:bearing,altitude:altitude});camera=new _luma.PerspectiveCamera,camera.view=(new _luma.Mat4).id(),convertToMat4(camera.projection,viewport.getProjectionMatrix())}return _react2["default"].createElement(_webglRenderer2["default"],_extends({},otherProps,{width:width,height:height,gl:gl,debug:debug,viewport:{x:0,y:0,width:width,height:height},camera:camera,scene:scene,blending:blending,pixelRatio:pixelRatio,onRendererInitialized:this._onRendererInitialized,onNeedRedraw:this._checkIfNeedRedraw,onMouseMove:this._onMouseMove,onClick:this._onClick}))}}]),DeckGLOverlay}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"_onRendererInitialized",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_onRendererInitialized"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onClick",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_onClick"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onMouseMove",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseMove"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_checkIfNeedRedraw",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_checkIfNeedRedraw"),_class.prototype),_class);exports["default"]=DeckGLOverlay},461:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _deckglOverlay=__webpack_require__(460),_deckglOverlay2=_interopRequireDefault(_deckglOverlay),_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_hexagonLayer=__webpack_require__(470),_hexagonLayer2=_interopRequireDefault(_hexagonLayer),_choroplethLayer=__webpack_require__(466),_choroplethLayer2=_interopRequireDefault(_choroplethLayer),_scatterplotLayer=__webpack_require__(473),_scatterplotLayer2=_interopRequireDefault(_scatterplotLayer),_gridLayer=__webpack_require__(468),_gridLayer2=_interopRequireDefault(_gridLayer),_arcLayer=__webpack_require__(464),_arcLayer2=_interopRequireDefault(_arcLayer),_lineLayer=__webpack_require__(471),_lineLayer2=_interopRequireDefault(_lineLayer);module.exports={DeckGLOverlay:_deckglOverlay2["default"],Layer:_layer2["default"],HexagonLayer:_hexagonLayer2["default"],ChoroplethLayer:_choroplethLayer2["default"],ScatterplotLayer:_scatterplotLayer2["default"],GridLayer:_gridLayer2["default"],ArcLayer:_arcLayer2["default"],LineLayer:_lineLayer2["default"]}},462:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function updateLayers(_ref){var oldLayers=_ref.oldLayers,newLayers=_ref.newLayers,gl=_ref.gl,scene=_ref.scene,error1=matchLayers(oldLayers,newLayers),error2=finalizeOldLayers(oldLayers),error3=updateMatchedLayers(newLayers),error4=initializeNewLayers(newLayers,{gl:gl});addLayersToScene(newLayers,scene);var error=error1||error2||error3||error4;if(error)throw error}function layersNeedRedraw(layers){var _ref2=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],_ref2$clearRedrawFlag=_ref2.clearRedrawFlags,clearRedrawFlags=void 0!==_ref2$clearRedrawFlag&&_ref2$clearRedrawFlag,redraw=!1,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=layers[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var layer=_step.value;redraw=redraw||layer.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return redraw}function layerName(layer){return layer?layer.constructor.name+"{id:'"+layer.props.id+"'}":"null layer"}function matchLayers(oldLayers,newLayers){var error=null,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=newLayers[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var newLayer=_step2.value;try{var oldLayer=_findMatchingLayer(oldLayers,newLayer);oldLayer&&((0,_log2["default"])(3,"matched "+layerName(newLayer),oldLayer,"=>",newLayer),_transferLayerState(oldLayer,newLayer))}catch(err){console.error("deck.gl error during matching of "+layerName(newLayer),err),error=error||err}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return error}function _findMatchingLayer(oldLayers,newLayer){var candidates=oldLayers.filter(function(l){return l.props.id===newLayer.props.id});if(candidates.length>1)throw new Error("deck.gl error layer has more than one match "+layerName(newLayer));return candidates.length>0&&candidates[0]}function _transferLayerState(oldLayer,newLayer){var state=oldLayer.state,props=oldLayer.props;(0,_assert2["default"])(state,"Matching layer has no state"),(0,_assert2["default"])(oldLayer!==newLayer,"Matching layer is same"),newLayer.state=state,state.layer=newLayer,state.model&&(state.model.userData.layer=newLayer),newLayer.oldProps=props,oldLayer.state=null}function initializeNewLayers(layers,_ref3){var gl=_ref3.gl;if(!gl)return null;var error=null,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=layers[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var layer=_step3.value;if(!layer.state){(0,_log2["default"])(1,"initializing "+layerName(layer));try{layer.initializeLayer({gl:gl})}catch(err){console.error("deck.gl error during initialization of "+layerName(layer),err),error=error||err}layer.state&&(layer.state.layer=layer),layer.state&&layer.state.model&&(layer.state.model.userData.layer=layer)}}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}return error}function updateMatchedLayers(newLayers){var error=null,_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=newLayers[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var layer=_step4.value,oldProps=layer.oldProps,props=layer.props;if(oldProps){try{layer.updateLayer(oldProps,props)}catch(err){console.error("deck.gl error during update of "+layerName(layer),err),error=error||err}(0,_log2["default"])(2,"updating "+layerName(layer))}}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}return error}function finalizeOldLayers(oldLayers){var error=null,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=oldLayers[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var layer=_step5.value,state=layer.state;if(state){try{layer.finalizeLayer()}catch(err){console.error("deck.gl error during finalization of "+layerName(layer),err),error=error||err}layer.state=null,(0,_log2["default"])(1,"finalizing "+layerName(layer))}}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}return error}function addLayersToScene(layers,scene){if(scene){scene.removeAll();var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=layers[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var layer=_step6.value;layer.state.model&&scene.add(layer.state.model)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateLayers=updateLayers,exports.layersNeedRedraw=layersNeedRedraw;var _log=__webpack_require__(249),_log2=_interopRequireDefault(_log),_assert=__webpack_require__(5),_assert2=_interopRequireDefault(_assert)},463:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_luma=__webpack_require__(65),ATTRIBUTES=(__webpack_require__(91),{instancePositions:{size:4,0:"x0",1:"y0",2:"x1",3:"y1"},instanceColors:{size:3,0:"red",1:"green",2:"blue"}}),RED=[255,0,0],BLUE=[0,0,255],ArcLayer=function(_Layer){function ArcLayer(){var _ref=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],_ref$strokeWidth=_ref.strokeWidth,strokeWidth=void 0===_ref$strokeWidth?1:_ref$strokeWidth,_ref$color=_ref.color0,color0=void 0===_ref$color?RED:_ref$color,_ref$color2=_ref.color1,color1=void 0===_ref$color2?BLUE:_ref$color2,opts=_objectWithoutProperties(_ref,["strokeWidth","color0","color1"]);return _classCallCheck(this,ArcLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(ArcLayer).call(this,_extends({strokeWidth:strokeWidth,color0:color0,color1:color1},opts)))}return _inherits(ArcLayer,_Layer),_createClass(ArcLayer,[{key:"initializeState",value:function(){var _state=this.state,gl=_state.gl,attributeManager=_state.attributeManager,model=this.createModel(gl);model.userData.strokeWidth=this.props.strokeWidth,this.setState({model:model}),attributeManager.addInstanced(ATTRIBUTES,{instancePositions:{update:this.calculateInstancePositions},instanceColors:{update:this.calculateInstanceColors}}),this.updateColors()}},{key:"willReceiveProps",value:function(oldProps,nextProps){_get(Object.getPrototypeOf(ArcLayer.prototype),"willReceiveProps",this).call(this,oldProps,nextProps),this.state.model.userData.strokeWidth=nextProps.strokeWidth,this.updateColors()}},{key:"createModel",value:function(gl){for(var positions=[],NUM_SEGMENTS=50,i=0;i<NUM_SEGMENTS;i++)positions=[].concat(_toConsumableArray(positions),[i,i,i]);return new _luma.Model({program:new _luma.Program(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* vertex shader for the arc-layer */\n#define SHADER_NAME arc-layer-vs\n\nconst float TILE_SIZE_1540259130 = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE_1540259130 = TILE_SIZE_1540259130 / (PI * 2.0);\n\n// non-linear projection: lnglats => zoom 0 tile [0-512, 0-512] * scale\nvec2 mercatorProject(vec2 lnglat, float zoomScale) {\n  float scale = WORLD_SCALE_1540259130 * zoomScale;\n  return vec2(\n  \tscale * (radians(lnglat.x) + PI),\n  \tscale * (PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)))\n  );\n}\n\nuniform float mercatorScale;\n\nconst float N = 49.0;\n\nattribute vec3 positions;\nattribute vec3 instanceColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\n\nuniform mat4 worldMatrix;\nuniform mat4 projectionMatrix;\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float index) {\n  float ratio = index / N;\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvoid main(void) {\n  vec2 source = mercatorProject(instancePositions.xy, mercatorScale);\n  vec2 target = mercatorProject(instancePositions.zw, mercatorScale);\n\n  // TODO - are we only using x coordinate?\n  float segmentIndex = positions.x;\n  vec3 p = vec3(\n    // xy: linear interpolation of source & target\n    mix(source, target, segmentIndex / N),\n    // z: paraboloid interpolate of source & target\n    sqrt(paraboloid(source, target, segmentIndex))\n  );\n\n  gl_Position = projectionMatrix * vec4(p, 1.0);\n\n  vec4 color = vec4(instanceColors / 255.0, opacity);\n  vec4 pickingColor = vec4(instancePickingColors / 255.0, opacity);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the arc-layer */\n#define SHADER_NAME arc-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',id:"arc"}),geometry:new _luma.Geometry({id:"arc",drawMode:"LINE_STRIP",positions:new Float32Array(positions)}),isInstanced:!0,onBeforeRender:function(){this.userData.oldStrokeWidth=gl.getParameter(gl.LINE_WIDTH),this.program.gl.lineWidth(this.userData.strokeWidth||1)},onAfterRender:function(){this.program.gl.lineWidth(this.userData.oldStrokeWidth||1)}})}},{key:"updateColors",value:function(){this.setUniforms({color0:this.props.color0,color1:this.props.color1})}},{key:"calculateInstancePositions",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var arc=_step.value;value[i+0]=arc.position.x0,value[i+1]=arc.position.y0,value[i+2]=arc.position.x1,value[i+3]=arc.position.y1,i+=size}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"calculateInstanceColors",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=data[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var point=_step2.value;value[i+0]=point.color[0],value[i+1]=point.color[1],value[i+2]=point.color[2],i+=size}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}}]),ArcLayer}(_layer2["default"]);exports["default"]=ArcLayer},464:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _arcLayer=__webpack_require__(463);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_arcLayer)["default"]}})},465:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_earcut=__webpack_require__(285),_earcut2=_interopRequireDefault(_earcut),_lodash=__webpack_require__(737),_lodash2=_interopRequireDefault(_lodash),_geojsonNormalize=__webpack_require__(690),_geojsonNormalize2=_interopRequireDefault(_geojsonNormalize),_luma=__webpack_require__(65),ATTRIBUTES=(__webpack_require__(91),{indices:{size:1,0:"index",isIndexed:!0},positions:{size:3,0:"x",1:"y",2:"unused"},colors:{size:3,0:"red",1:"green",2:"blue"},pickingColors:{size:3,0:"pickRed",1:"pickGreen",2:"pickBlue"}}),ChoroplethLayer=function(_Layer){function ChoroplethLayer(props){return _classCallCheck(this,ChoroplethLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(ChoroplethLayer).call(this,_extends({opacity:1},props)))}return _inherits(ChoroplethLayer,_Layer),_createClass(ChoroplethLayer,[{key:"initializeState",value:function(){var _state=this.state,gl=_state.gl,attributeManager=_state.attributeManager;attributeManager.addDynamic(ATTRIBUTES,{indices:{update:this.calculateIndices},positions:{update:this.calculatePositions},colors:{update:this.calculateColors},pickingColors:{update:this.calculatePickingColors,noAlloc:!0}}),this.setUniforms({opacity:this.props.opacity}),this.setState({numInstances:0,model:this.getModel(gl)}),this.extractChoropleths()}},{key:"willReceiveProps",value:function(oldProps,newProps){_get(Object.getPrototypeOf(ChoroplethLayer.prototype),"willReceiveProps",this).call(this,oldProps,newProps);var _state2=this.state,dataChanged=_state2.dataChanged,attributeManager=_state2.attributeManager;dataChanged&&(this.extractChoropleths(),attributeManager.invalidateAll()),oldProps.opacity!==newProps.opacity&&this.setUniforms({opacity:newProps.opacity})}},{key:"getModel",value:function(gl){return new _luma.Model({program:new _luma.Program(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* vertex shader for the choropleth-layer */\n#define SHADER_NAME choropleth-layer-vertex-shader\n\nconst float TILE_SIZE_1540259130 = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE_1540259130 = TILE_SIZE_1540259130 / (PI * 2.0);\n\n// non-linear projection: lnglats => zoom 0 tile [0-512, 0-512] * scale\nvec2 mercatorProject(vec2 lnglat, float zoomScale) {\n  float scale = WORLD_SCALE_1540259130 * zoomScale;\n  return vec2(\n  \tscale * (radians(lnglat.x) + PI),\n  \tscale * (PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)))\n  );\n}\n\nuniform float mercatorScale;\n\nattribute vec3 positions;\nattribute vec3 colors;\nattribute vec3 pickingColors;\n\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\nvarying vec4 vColor;\n\nvec4 getColor(vec4 color, float opacity, vec3 pickingColor, float renderPickingBuffer) {\n  vec4 color4 = vec4(color.xyz / 255., color.w / 255. * opacity);\n  vec4 pickingColor4 = vec4(pickingColor / 255., 1.);\n  return mix(color4, pickingColor4, renderPickingBuffer);\n}\n\nvoid main(void) {\n  vec2 pos = mercatorProject(positions.xy, mercatorScale);\n  // For some reason, need to add one to elevation to show up in untilted mode\n  vec3 p = vec3(pos.xy, positions.z + 1.);\n  gl_Position = projectionMatrix * vec4(p, 1.);\n\n  vec4 color = vec4(colors / 255., opacity);\n  vec4 pickingColor = vec4(pickingColors / 255., 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n\n  // float alpha = pickingColors == selectedPickingColor ? 0.5 : opacity;\n  // vColor = vec4(mix(colors / 255., pickingColors / 255., renderPickingBuffer), alpha);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the choropleth-layer */\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',id:"choropleth"}),geometry:new _luma.Geometry({id:this.props.id,drawMode:this.props.drawContour?"LINES":"TRIANGLES"}),vertexCount:0,isIndexed:!0})}},{key:"calculatePositions",value:function(attribute){var vertices=(0,_lodash2["default"])(this.state.groupedVertices);attribute.value=new Float32Array(vertices)}},{key:"calculateIndices",value:function(attribute){var _this2=this,offsets=this.state.groupedVertices.reduce(function(acc,vertices){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+vertices.length])},[0]),indices=this.state.groupedVertices.map(function(vertices,choroplethIndex){return _this2.props.drawContour?_this2.calculateContourIndices(vertices.length).map(function(index){return index+offsets[choroplethIndex]}):(0,
_earcut2["default"])((0,_lodash2["default"])(vertices),null,3).map(function(index){return index+offsets[choroplethIndex]})});attribute.value=new Uint16Array((0,_lodash2["default"])(indices)),attribute.target=this.state.gl.ELEMENT_ARRAY_BUFFER,this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculateColors",value:function(attribute){var _this3=this,colors=this.state.groupedVertices.map(function(vertices){return vertices.map(function(vertex){return _this3.props.drawContour?[0,0,0]:[128,128,128]})});attribute.value=new Float32Array((0,_lodash2["default"])(colors))}},{key:"calculatePickingColors",value:function(attribute){var _this4=this,colors=this.state.groupedVertices.map(function(vertices,choroplethIndex){return vertices.map(function(vertex){return _this4.props.drawContour?[-1,-1,-1]:[(choroplethIndex+1)%256,Math.floor((choroplethIndex+1)/256)%256,Math.floor((choroplethIndex+1)/256/256)%256]})});attribute.value=new Float32Array((0,_lodash2["default"])(colors))}},{key:"extractChoropleths",value:function(){var data=this.props.data,normalizedGeojson=(0,_geojsonNormalize2["default"])(data);this.state.choropleths=normalizedGeojson.features.map(function(choropleth){var coordinates=choropleth.geometry.coordinates[0];return 1===coordinates.length&&coordinates[0].length>2&&(coordinates=coordinates[0]),{properties:choropleth.properties,coordinates:coordinates}}),this.state.groupedVertices=this.state.choropleths.map(function(choropleth){return choropleth.coordinates.map(function(coordinate){return[coordinate[0],coordinate[1],0]})})}},{key:"calculateContourIndices",value:function(numVertices){for(var indices=[],i=1;i<numVertices-1;i++)indices=[].concat(_toConsumableArray(indices),[i,i]);return[0].concat(_toConsumableArray(indices),[0])}},{key:"onHover",value:function(info){var index=info.index,data=this.props.data,feature=data.features[index];this.props.onHover(_extends({},info,{feature:feature}))}},{key:"onClick",value:function(info){var index=info.index,data=this.props.data,feature=data.features[index];this.props.onClick(_extends({},info,{feature:feature}))}}]),ChoroplethLayer}(_layer2["default"]);exports["default"]=ChoroplethLayer},466:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _choroplethLayer=__webpack_require__(465);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_choroplethLayer)["default"]}})},467:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_luma=__webpack_require__(65),ATTRIBUTES=(__webpack_require__(91),{instancePositions:{size:3,0:"x",1:"y",2:"unused"},instanceColors:{size:4,0:"red",1:"green",2:"blue",3:"alpha"}}),GridLayer=function(_Layer){function GridLayer(opts){return _classCallCheck(this,GridLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(GridLayer).call(this,_extends({unitWidth:100,unitHeight:100},opts)))}return _inherits(GridLayer,_Layer),_createClass(GridLayer,null,[{key:"attributes",get:function(){return ATTRIBUTES}}]),_createClass(GridLayer,[{key:"initializeState",value:function(){var _state=this.state,gl=_state.gl,attributeManager=_state.attributeManager;this.setState({model:this.getModel(gl)}),attributeManager.addInstanced(ATTRIBUTES,{instancePositions:{update:this.calculateInstancePositions},instanceColors:{update:this.calculateInstanceColors}}),this.updateCell()}},{key:"willReceiveProps",value:function(oldProps,newProps){_get(Object.getPrototypeOf(GridLayer.prototype),"willReceiveProps",this).call(this,oldProps,newProps);var cellSizeChanged=newProps.unitWidth!==oldProps.unitWidth||newProps.unitHeight!==oldProps.unitHeight;(cellSizeChanged||this.state.viewportChanged)&&this.updateCell()}},{key:"getModel",value:function(gl){return new _luma.Model({program:new _luma.Program(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* vertex shader for the grid-layer */\n#define SHADER_NAME grid-layer-vs\n\nattribute vec3 vertices;\nattribute vec3 instancePositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float mercatorScale;\n\nuniform float maxCount;\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 scale;\nuniform vec3 selectedPickingColor;\n\nuniform mat4 worldMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  float alpha = instancePickingColors == selectedPickingColor ? 1.5 * instanceColors.w : instanceColors.w;\n  vColor = vec4(mix(instanceColors.xyz / maxCount, instancePickingColors / 255., renderPickingBuffer), alpha);\n\n  vec3 p = instancePositions + vertices * scale / mercatorScale;\n  gl_Position = projectionMatrix * worldMatrix * vec4(p, 1.0);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the grid-layer */\n#define SHADER_NAME grid-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',id:"grid"}),geometry:new _luma.Geometry({id:this.props.id,drawMode:"TRIANGLE_FAN",vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}),isInstanced:!0})}},{key:"updateCell",value:function(){var _props=this.props,width=_props.width,height=_props.height,unitWidth=_props.unitWidth,unitHeight=_props.unitHeight,numCol=Math.ceil(2*width/unitWidth),numRow=Math.ceil(2*height/unitHeight);this.setState({numCol:numCol,numRow:numRow,numInstances:numCol*numRow});var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();var MARGIN=2,scale=new Float32Array([unitWidth-2*MARGIN,unitHeight-2*MARGIN,1]);this.setUniforms({scale:scale})}},{key:"calculateInstancePositions",value:function(attribute,numInstances){for(var _props2=this.props,unitWidth=_props2.unitWidth,unitHeight=_props2.unitHeight,width=_props2.width,height=_props2.height,numCol=this.state.numCol,value=attribute.value,size=attribute.size,i=0;i<numInstances;i++){var x=i%numCol,y=Math.floor(i/numCol);value[i*size+0]=x*unitWidth-width,value[i*size+1]=y*unitHeight-height,value[i*size+2]=0}}},{key:"calculateInstanceColors",value:function(attribute){var _props3=this.props,data=_props3.data,unitWidth=_props3.unitWidth,unitHeight=_props3.unitHeight,width=_props3.width,height=_props3.height,_state2=this.state,numCol=_state2.numCol,numRow=_state2.numRow,value=attribute.value,size=attribute.size;value.fill(0);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var point=_step.value,pixel=this.project([point.position.y,point.position.x]),colId=Math.floor((pixel.x+width)/unitWidth),rowId=Math.floor((pixel.y+height)/unitHeight);if(colId<numCol&&rowId<numRow){var i4=(colId+rowId*numCol)*size;value[i4+2]=value[i4+0]+=1,value[i4+1]+=5,value[i4+3]=.6}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}this.setUniforms({maxCount:Math.max.apply(Math,_toConsumableArray(value))})}}]),GridLayer}(_layer2["default"]);exports["default"]=GridLayer},468:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _gridLayer=__webpack_require__(467);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_gridLayer)["default"]}})},469:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_luma=__webpack_require__(65),ATTRIBUTES=(__webpack_require__(91),{instancePositions:{size:2,0:"x",1:"y"},instanceElevations:{size:1,0:"z"},instanceColors:{size:3,0:"red",1:"green",2:"blue"}}),_getCentroid=function(x){return x.centroid},_getElevation=function(x){return x.elevation||0},_getColor=function(x){return x.color||[255,0,0]},_getVertices=function(x){return x.vertices},HexagonLayer=function(_Layer){function HexagonLayer(){var _ref=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],_ref$id=_ref.id,id=void 0===_ref$id?"hexagon-layer":_ref$id,_ref$dotRadius=_ref.dotRadius,dotRadius=void 0===_ref$dotRadius?10:_ref$dotRadius,_ref$elevation=_ref.elevation,elevation=void 0===_ref$elevation?100:_ref$elevation,vertices=_ref.vertices,_ref$getCentroid=_ref.getCentroid,getCentroid=void 0===_ref$getCentroid?_getCentroid:_ref$getCentroid,_ref$getElevation=_ref.getElevation,getElevation=void 0===_ref$getElevation?_getElevation:_ref$getElevation,_ref$getColor=_ref.getColor,getColor=void 0===_ref$getColor?_getColor:_ref$getColor,_ref$getVertices=_ref.getVertices,getVertices=void 0===_ref$getVertices?_getVertices:_ref$getVertices,opts=_objectWithoutProperties(_ref,["id","dotRadius","elevation","vertices","getCentroid","getElevation","getColor","getVertices"]);return _classCallCheck(this,HexagonLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(HexagonLayer).call(this,_extends({id:id,dotRadius:dotRadius,elevation:elevation,vertices:vertices,getCentroid:getCentroid,getElevation:getElevation,getColor:getColor,getVertices:getVertices},opts)))}return _inherits(HexagonLayer,_Layer),_createClass(HexagonLayer,[{key:"initializeState",value:function(){var _state=this.state,gl=_state.gl,attributeManager=_state.attributeManager;this.setState({model:this.getModel(gl)}),attributeManager.addInstanced(ATTRIBUTES,{instancePositions:{update:this.calculateInstancePositions},instanceElevations:{update:this.calculateInstanceElevations},instanceColors:{update:this.calculateInstanceColors}}),this.calculateRadiusAndAngle(),this.setUniforms({elevation:this.props.elevation})}},{key:"willReceiveProps",value:function(oldProps,newProps){_get(Object.getPrototypeOf(HexagonLayer.prototype),"willReceiveProps",this).call(this,oldProps,newProps);var _state2=this.state,dataChanged=_state2.dataChanged,viewportChanged=_state2.viewportChanged,attributeManager=_state2.attributeManager;(dataChanged||viewportChanged)&&this.calculateRadiusAndAngle(),dataChanged&&attributeManager.invalidateAll(),this.setUniforms({elevation:this.props.elevation})}},{key:"getModel",value:function(gl){var geometry=new _luma.CylinderGeometry({radius:1,topRadius:1,bottomRadius:1,topCap:!0,bottomCap:!0,height:1,nradial:6,nvertical:1});return new _luma.Model({id:this.props.id,program:new _luma.Program(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the hexagon-layer */\n#define SHADER_NAME hexagon-layer-vs\n\nconst float TILE_SIZE_1540259130 = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE_1540259130 = TILE_SIZE_1540259130 / (PI * 2.0);\n\n// non-linear projection: lnglats => zoom 0 tile [0-512, 0-512] * scale\nvec2 mercatorProject(vec2 lnglat, float zoomScale) {\n  float scale = WORLD_SCALE_1540259130 * zoomScale;\n  return vec2(\n  \tscale * (radians(lnglat.x) + PI),\n  \tscale * (PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)))\n  );\n}\n\nuniform float mercatorScale;\n\nattribute vec3 positions;\n\nattribute vec2 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform mat4 worldMatrix;\nuniform mat4 projectionMatrix;\n\nuniform float radius;\nuniform float opacity;\nuniform float angle;\nuniform float elevation;\n\nuniform float renderPickingBuffer;\nuniform vec3 selected;\nvarying vec4 vColor;\n\nvoid main(void) {\n  mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));\n  vec4 rotatedPosition = vec4(\n    vec2(rotationMatrix * positions.xz * radius),\n    0.,\n    1.\n  );\n\n  vec2 pos = mercatorProject(instancePositions.xy, mercatorScale);\n\n  vec4 centroidPosition =\n    vec4(pos.xy, instanceElevations * (positions.y + 0.5) * elevation, 0.0);\n  vec3 p = centroidPosition.xyz + rotatedPosition.xyz;\n  gl_Position = projectionMatrix * vec4(p, 1.0);\n\n  vec4 color = vec4(instanceColors / 255.0, opacity);\n  vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the hexagon-layer */\n#define SHADER_NAME hexagon-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',id:"hexagon"}),geometry:geometry,isInstanced:!0})}},{key:"calculateInstancePositions",value:function(attribute){var _props=this.props,data=_props.data,getCentroid=_props.getCentroid,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var hexagon=_step.value,centroid=getCentroid(hexagon);value[i+0]=centroid[0],value[i+1]=centroid[1],i+=size}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"calculateInstanceElevations",value:function(attribute){var _props2=this.props,data=_props2.data,getElevation=_props2.getElevation,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=data[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var hexagon=_step2.value,elevation=getElevation(hexagon)||0;value[i+0]=elevation,i+=size}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"calculateInstanceColors",value:function(attribute){var _props3=this.props,data=_props3.data,getColor=_props3.getColor,value=attribute.value,i=0,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=data[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var hexagon=_step3.value,color=getColor(hexagon);value[i+0]=color[0],value[i+1]=color[1],value[i+2]=color[2],i+=3}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}}},{key:"calculateRadiusAndAngle",value:function(){var _props4=this.props,data=_props4.data,getVertices=_props4.getVertices;if(data&&0!==data.length){var vertices=this.props.vertices;if(!vertices){var firstHexagon=this.getFirstObject();vertices=getVertices(firstHexagon)}var vertex0=vertices[0],vertex3=vertices[3],spaceCoord0=this.project({lat:vertex0[1],lon:vertex0[0]}),spaceCoord3=this.project({lat:vertex3[1],lon:vertex3[0]}),dx=spaceCoord0.x-spaceCoord3.x,dy=spaceCoord0.y-spaceCoord3.y,dxy=Math.sqrt(dx*dx+dy*dy);this.setUniforms({angle:Math.acos(dx/dxy)*-Math.sign(dy)+Math.PI/2,radius:dxy/2*Math.min(1,this.props.dotRadius)})}}}]),HexagonLayer}(_layer2["default"]);exports["default"]=HexagonLayer},470:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _hexagonLayer=__webpack_require__(469);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_hexagonLayer)["default"]}})},471:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _lineLayer=__webpack_require__(472);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_lineLayer)["default"]}})},472:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_luma=__webpack_require__(65),ATTRIBUTES=(__webpack_require__(91),{instancePositions:{size:4,0:"x0",1:"y0",2:"x1",3:"y1"},instanceColors:{size:3,0:"red",1:"green",2:"blue"}}),LineLayer=function(_Layer){function LineLayer(){var _ref=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],_ref$strokeWidth=_ref.strokeWidth,strokeWidth=void 0===_ref$strokeWidth?9:_ref$strokeWidth,opts=_objectWithoutProperties(_ref,["strokeWidth"]);return _classCallCheck(this,LineLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(LineLayer).call(this,_extends({strokeWidth:strokeWidth},opts)))}return _inherits(LineLayer,_Layer),_createClass(LineLayer,[{key:"initializeState",value:function(){var _state=this.state,gl=_state.gl,attributeManager=_state.attributeManager,model=this.createModel(gl);model.userData.strokeWidth=this.props.strokeWidth,this.setState({model:model}),attributeManager.addInstanced(ATTRIBUTES,{instancePositions:{update:this.calculateInstancePositions},instanceColors:{update:this.calculateInstanceColors}})}},{key:"willReceiveProps",value:function(oldProps,nextProps){_get(Object.getPrototypeOf(LineLayer.prototype),"willReceiveProps",this).call(this,oldProps,nextProps),this.state.model.userData.strokeWidth=nextProps.strokeWidth}},{key:"createModel",value:function(gl){var positions=[0,0,0,1,1,1];return new _luma.Model({program:new _luma.Program(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* vertex shader for the line-layer */\n#define SHADER_NAME line-layer-vs\n\nconst float TILE_SIZE_1540259130 = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE_1540259130 = TILE_SIZE_1540259130 / (PI * 2.0);\n\n// non-linear projection: lnglats => zoom 0 tile [0-512, 0-512] * scale\nvec2 mercatorProject(vec2 lnglat, float zoomScale) {\n  float scale = WORLD_SCALE_1540259130 * zoomScale;\n  return vec2(\n  \tscale * (radians(lnglat.x) + PI),\n  \tscale * (PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)))\n  );\n}\n\nuniform float mercatorScale;\n\nattribute vec3 positions;\nattribute vec3 instanceColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\n\nuniform mat4 worldMatrix;\nuniform mat4 projectionMatrix;\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec2 source = mercatorProject(instancePositions.xy, mercatorScale);\n  vec2 target = mercatorProject(instancePositions.zw, mercatorScale);\n\n  float segmentIndex = positions.x;\n  vec3 p = vec3(\n    // xy: linear interpolation of source & target\n    mix(source, target, segmentIndex),\n    // As per similar comment in choropleth-layer-vertex.glsl\n    // For some reason, need to add one to elevation to show up in untilted mode\n    // This seems to be only a problem on a Mac and not in Windows.\n    1.0\n  );\n\n  gl_Position = projectionMatrix * vec4(p, 1.0);\n\n  vec4 color = vec4(instanceColors / 255.0, opacity);\n  vec4 pickingColor = vec4(instancePickingColors / 255.0, opacity);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n',
fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the line-layer */\n#define SHADER_NAME line-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',id:"line"}),geometry:new _luma.Geometry({id:"line",drawMode:"LINE_STRIP",positions:new Float32Array(positions)}),isInstanced:!0,onBeforeRender:function(){this.userData.oldStrokeWidth=gl.getParameter(gl.LINE_WIDTH),this.program.gl.lineWidth(this.userData.strokeWidth||1)},onAfterRender:function(){this.program.gl.lineWidth(this.userData.oldStrokeWidth||1)}})}},{key:"calculateInstancePositions",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var line=_step.value;value[i+0]=line.position.x0,value[i+1]=line.position.y0,value[i+2]=line.position.x1,value[i+3]=line.position.y1,i+=size}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"calculateInstanceColors",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=data[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var point=_step2.value;value[i+0]=point.color[0],value[i+1]=point.color[1],value[i+2]=point.color[2],i+=size}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}}]),LineLayer}(_layer2["default"]);exports["default"]=LineLayer},473:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _scatterplotLayer=__webpack_require__(474);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_scatterplotLayer)["default"]}})},474:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_layer=__webpack_require__(80),_layer2=_interopRequireDefault(_layer),_luma=__webpack_require__(65),ATTRIBUTES=(__webpack_require__(91),{instancePositions:{size:3,0:"x",1:"y",2:"unused"},instanceColors:{size:3,0:"red",1:"green",2:"blue"},instanceRadius:{size:1,0:"radius"}}),ScatterplotLayer=function(_Layer){function ScatterplotLayer(props){return _classCallCheck(this,ScatterplotLayer),_possibleConstructorReturn(this,Object.getPrototypeOf(ScatterplotLayer).call(this,props))}return _inherits(ScatterplotLayer,_Layer),_createClass(ScatterplotLayer,null,[{key:"attributes",get:function(){return ATTRIBUTES}}]),_createClass(ScatterplotLayer,[{key:"initializeState",value:function(){var gl=this.state.gl,attributeManager=this.state.attributeManager;this.setState({model:this.getModel(gl)}),attributeManager.addInstanced(ATTRIBUTES,{instancePositions:{update:this.calculateInstancePositions},instanceColors:{update:this.calculateInstanceColors},instanceRadius:{update:this.calculateInstanceRadius}})}},{key:"didMount",value:function(){this.updateUniforms()}},{key:"willReceiveProps",value:function(oldProps,newProps){_get(Object.getPrototypeOf(ScatterplotLayer.prototype),"willReceiveProps",this).call(this,oldProps,newProps),this.updateUniforms()}},{key:"getModel",value:function(gl){for(var NUM_SEGMENTS=16,PI2=2*Math.PI,positions=[],i=0;i<NUM_SEGMENTS;i++)positions=[].concat(_toConsumableArray(positions),[Math.cos(PI2*i/NUM_SEGMENTS),Math.sin(PI2*i/NUM_SEGMENTS),0]);return new _luma.Model({program:new _luma.Program(gl,{vs:'#define GLSLIFY 1\n// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* vertex shader for the scatterplot-layer */\n#define SHADER_NAME scatterplot-layer-vs\n\nhighp float random(vec2 co) {\n  highp float a = 12.9898;\n  highp float b = 78.233;\n  highp float c = 43758.5453;\n  highp float dt= dot(co.xy ,vec2(a,b));\n  highp float sn= mod(dt,3.14);\n  return fract(sin(sn) / c) - .5;\n}\n\nconst float TILE_SIZE_1604150559 = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE_1604150559 = TILE_SIZE_1604150559 / (PI * 2.0);\n\n// non-linear projection: lnglats => zoom 0 tile [0-512, 0-512] * scale\nvec2 mercatorProject(vec2 lnglat, float zoomScale) {\n  float scale = WORLD_SCALE_1604150559 * zoomScale;\n  return vec2(\n  \tscale * (radians(lnglat.x) + PI),\n  \tscale * (PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)))\n  );\n}\n\nuniform float mercatorScale;\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec3 instanceColors;\nattribute vec3 instancePickingColors;\n\nattribute float instanceRadius;\nuniform float opacity;\n\nuniform mat4 worldMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nuniform float renderPickingBuffer;\n\nvoid main(void) {\n  // vec2 pos = mercatorProject(instancePositions.xy);\n  // vec3 p = vec3(pos, instancePositions.z) + positions * instanceRadius;\n  // // gl_Position = projectionMatrix * vec4(p, 1.0);\n  // // float rand = random(pos);\n  // // gl_Position = vec4(rand, rand, 0, 1.);\n\n  // vec4 color = vec4(instanceColors / 255.0, 1.);\n  // vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.);\n  // vColor = mix(color, pickingColor, renderPickingBuffer);\n\n  vec2 pos = mercatorProject(instancePositions.xy, mercatorScale);\n  // For some reason, need to add one to elevation to show up in untilted mode\n  vec3 p = vec3(pos, instancePositions.z + 1.) + positions * instanceRadius;\n  gl_Position = projectionMatrix * vec4(p, 1.0);\n\n  vec4 color = vec4(instanceColors / 255.0, 1.);\n  vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n',fs:'// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the scatterplot-layer */\n#define SHADER_NAME scatterplot-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n',id:"scatterplot"}),geometry:new _luma.Geometry({drawMode:"TRIANGLE_FAN",positions:new Float32Array(positions)}),isInstanced:!0})}},{key:"updateUniforms",value:function(){}},{key:"calculateInstancePositions",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var point=_step.value;value[i+0]=point.position.x,value[i+1]=point.position.y,value[i+2]=point.position.z,i+=size}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"calculateInstanceRadius",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var point=_step.value;value[i+0]=point.radius,i+=size}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"calculateInstanceColors",value:function(attribute){var data=this.props.data,value=attribute.value,size=attribute.size,i=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=data[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var point=_step2.value;value[i+0]=point.color[0],value[i+1]=point.color[1],value[i+2]=point.color[2],i+=size}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}}]),ScatterplotLayer}(_layer2["default"]);exports["default"]=ScatterplotLayer},475:function(module,exports){"use strict";function addIterator(object){isPlainObject(object)&&!object[Symbol.iterator]&&(object[Symbol.iterator]=function(){return valueIterator(this)})}function valueIterator(obj){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,key;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,_context.prev=3,_iterator=Object.keys(obj)[Symbol.iterator]();case 5:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=13;break}if(key=_step.value,!obj.hasOwnProperty(key)||key===Symbol.iterator){_context.next=10;break}return _context.next=10,obj[key];case 10:_iteratorNormalCompletion=!0,_context.next=5;break;case 13:_context.next=19;break;case 15:_context.prev=15,_context.t0=_context["catch"](3),_didIteratorError=!0,_iteratorError=_context.t0;case 19:_context.prev=19,_context.prev=20,!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]();case 22:if(_context.prev=22,!_didIteratorError){_context.next=25;break}throw _iteratorError;case 25:return _context.finish(22);case 26:return _context.finish(19);case 27:case"end":return _context.stop()}},_marked[0],this,[[3,15,19,27],[20,,22,26]])}function isPlainObject(o){return null!==o&&"object"===("undefined"==typeof o?"undefined":_typeof(o))&&o.constructor===Object}function areEqualShallow(a,b){var _ref=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],_ref$ignore=_ref.ignore,ignore=void 0===_ref$ignore?{}:_ref$ignore;if(a===b)return!0;if("object"!==("undefined"==typeof a?"undefined":_typeof(a))||null===a||"object"!==("undefined"==typeof b?"undefined":_typeof(b))||null===b)return!1;if(Object.keys(a).length!==Object.keys(b).length)return!1;for(var key in a)if(!(key in ignore||key in b&&a[key]===b[key]))return!1;for(var _key in b)if(!(_key in ignore||_key in a))return!1;return!0}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return"undefined"==typeof obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":"undefined"==typeof obj?"undefined":_typeof2(obj)};exports.addIterator=addIterator,exports.areEqualShallow=areEqualShallow;var _marked=[valueIterator].map(regeneratorRuntime.mark)},476:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _viewport=__webpack_require__(478);Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _interopRequireDefault(_viewport)["default"]}}),Object.defineProperty(exports,"Viewport",{enumerable:!0,get:function(){return _interopRequireDefault(_viewport)["default"]}});var _mapboxTransform=__webpack_require__(477);Object.defineProperty(exports,"MapboxTransform",{enumerable:!0,get:function(){return _interopRequireDefault(_mapboxTransform)["default"]}})},477:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function LngLat(lng,lat){if(isNaN(lng)||isNaN(lat))throw new Error("Invalid LngLat object: ("+lng+", "+lat+")");if(this.lng=Number(lng),this.lat=Number(lat),this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_glMatrix=__webpack_require__(103),MapboxTransform=function(){function MapboxTransform(_ref){var _ref$width=_ref.width,width=void 0===_ref$width?0:_ref$width,_ref$height=_ref.height,height=void 0===_ref$height?0:_ref$height,_ref$latitude=_ref.latitude,latitude=void 0===_ref$latitude?0:_ref$latitude,_ref$longitude=_ref.longitude,longitude=void 0===_ref$longitude?0:_ref$longitude,_ref$zoom=_ref.zoom,zoom=void 0===_ref$zoom?0:_ref$zoom,_ref$altitude=_ref.altitude,altitude=void 0===_ref$altitude?1.5:_ref$altitude,_ref$pitch=_ref.pitch,pitch=void 0===_ref$pitch?0:_ref$pitch,_ref$bearing=_ref.bearing,bearing=void 0===_ref$bearing?0:_ref$bearing;_classCallCheck(this,MapboxTransform),this.tileSize=512,this.width=0,this.height=0,this._center=new LngLat(0,0),this.zoom=0,this.angle=0,this._altitude=1.5,this._pitch=0,this.width=width,this.height=height,this.zoom=zoom,this.center=new LngLat(longitude,latitude),this.altitude=altitude,this.pitch=pitch,this.bearing=bearing,this._calcProjMatrix()}return _createClass(MapboxTransform,[{key:"zoomScale",value:function(zoom){return Math.pow(2,zoom)}},{key:"lngX",value:function(lng,worldSize){return(180+lng)*(worldSize||this.worldSize)/360}},{key:"latY",value:function(lat,worldSize){var y=180/Math.PI*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360));return(180-y)*(worldSize||this.worldSize)/360}},{key:"_calcProjMatrix",value:function(){var m=new Float32Array(16),halfFov=Math.atan(.5/this.altitude),topHalfSurfaceDistance=Math.sin(halfFov)*this.altitude/Math.sin(Math.PI/2-this._pitch-halfFov),farZ=Math.cos(Math.PI/2-this._pitch)*topHalfSurfaceDistance+this.altitude;_glMatrix.mat4.perspective(m,2*Math.atan(this.height/2/this.altitude),this.width/this.height,.1,farZ),_glMatrix.mat4.translate(m,m,[0,0,-this.altitude]),_glMatrix.mat4.scale(m,m,[1,-1,1/this.height]),_glMatrix.mat4.rotateX(m,m,this._pitch),_glMatrix.mat4.rotateZ(m,m,this.angle),_glMatrix.mat4.translate(m,m,[-this.x,-this.y,0]),this.projMatrix=m}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(bearing){var b=-bearing*Math.PI/180;this.angle!==b&&(this.angle=b,this.rotationMatrix=_glMatrix.mat2.create(),_glMatrix.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(pitch){var p=Math.min(60,pitch)/180*Math.PI;this._pitch!==p&&(this._pitch=p)}},{key:"altitude",get:function(){return this._altitude},set:function(altitude){var a=Math.max(.75,altitude);this._altitude!==a&&(this._altitude=a)}},{key:"zoom",get:function(){return this._zoom},set:function(zoom){var z=zoom;this._zoom!==z&&(this._zoom=z,this.scale=this.zoomScale(z),this.tileZoom=Math.floor(z),this.zoomFraction=z-this.tileZoom)}},{key:"center",get:function(){return this._center},set:function(center){center.lat===this._center.lat&&center.lng===this._center.lng||(this._center=center)}},{key:"x",get:function(){return this.lngX(this.center.lng)}},{key:"y",get:function(){return this.latY(this.center.lat)}}]),MapboxTransform}();exports["default"]=MapboxTransform},478:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_glMatrix=__webpack_require__(103),PI=Math.PI,PI_2=PI/2,PI_4=PI/4,DEGREES_TO_RADIANS=PI/180,RADIANS_TO_DEGREES=180/PI,TILE_SIZE=512,WORLD_SCALE=TILE_SIZE/PI_2,Viewport=function(){function Viewport(_ref){var _ref$width=_ref.width,width=void 0===_ref$width?0:_ref$width,_ref$height=_ref.height,height=void 0===_ref$height?0:_ref$height,_ref$latitude=_ref.latitude,latitude=void 0===_ref$latitude?0:_ref$latitude,_ref$longitude=_ref.longitude,longitude=void 0===_ref$longitude?0:_ref$longitude,_ref$zoom=_ref.zoom,zoom=void 0===_ref$zoom?0:_ref$zoom,_ref$pitch=_ref.pitch,pitch=void 0===_ref$pitch?0:_ref$pitch,_ref$bearing=_ref.bearing,bearing=void 0===_ref$bearing?0:_ref$bearing,_ref$altitude=_ref.altitude,altitude=void 0===_ref$altitude?1.5:_ref$altitude;_classCallCheck(this,Viewport),this.width=width,this.height=height,this.zoom=zoom,this.latitude=latitude,this.longitude=longitude,this.bearing=bearing,this.scale=Math.pow(2,zoom),this.worldSize=TILE_SIZE*this.scale,this.tileZoom=Math.floor(zoom),this.zoomFraction=zoom-Math.floor(zoom),this.bearingRadians=bearing/180*Math.PI,this.bearingRotationMatrix=_glMatrix.mat2.create(),_glMatrix.mat2.rotate(this.bearingRotationMatrix,this.bearingRotationMatrix,this.bearing),this.originalPitch=pitch,this.pitch=Math.min(60,pitch),this.pitchRadians=Math.min(60,pitch)/180*Math.PI,this.originalAltitude=altitude,this.altitude=Math.max(.75,altitude);var y=180/Math.PI*Math.log(Math.tan(Math.PI/4+latitude*Math.PI/360));this.centerX0=(180+longitude)/360*TILE_SIZE,this.centerY0=(180-y)/360*TILE_SIZE,this.centerX=this.centerX0*this.scale,this.centerY=this.centerY0*this.scale,this.halfFov=Math.atan(.5/this.altitude),this.topHalfSurfaceDistance=Math.sin(this.halfFov)*this.altitude/Math.sin(Math.PI/2-this.pitchRadians-this.halfFov),this.farZ=Math.cos(Math.PI/2-this.pitchRadians)*this.topHalfSurfaceDistance+this.altitude,this._precomputeMatrices()}return _createClass(Viewport,[{key:"project",value:function(lngLatZ){var _projectZoom=this.projectZoom0(lngLatZ),_projectZoom2=_slicedToArray(_projectZoom,2),x=_projectZoom2[0],y=_projectZoom2[1],v=_glMatrix.vec4.fromValues(x,y,lngLatZ[2]||0,1);_glMatrix.vec4.transformMat4(v,v,this.viewMatrix),_glMatrix.vec4.transformMat4(v,v,this.projectionMatrix)}},{key:"projectZoom0",value:function(_ref2){var _ref3=_slicedToArray(_ref2,2),lng=_ref3[0],lat=_ref3[1],lambda2=lng*DEGREES_TO_RADIANS,phi2=lat*DEGREES_TO_RADIANS,x=WORLD_SCALE*(lambda2+PI),y=WORLD_SCALE*(PI-Math.log(Math.tan(PI_4+.5*phi2)));return[x,y]}},{key:"unprojectZoom0",value:function(_ref4){var _ref5=_slicedToArray(_ref4,2),x=_ref5[0],y=_ref5[1],lambda2=x/WORLD_SCALE-PI,phi2=2*(Math.atan(Math.exp(PI-y/WORLD_SCALE))-PI_4);return[lambda2*RADIANS_TO_DEGREES,phi2*RADIANS_TO_DEGREES]}},{key:"getProjectionMatrix",value:function(){return this._glProjectionMatrix}},{key:"_precomputeMatrices",value:function(){this._glProjectionMatrix=this._calculateGLProjectionMatrix();var m=_glMatrix.mat4.create();_glMatrix.mat4.translate(m,m,[.5,.5,0]),_glMatrix.mat4.scale(m,m,[this.width,this.height,1]),_glMatrix.mat4.multiply(m,m,this._glProjectionMatrix),this._pixelProjectionMatrix=m;var mInverse=_glMatrix.mat4.clone(m);_glMatrix.mat4.invert(mInverse,mInverse)}},{key:"_calculateGLProjectionMatrix",value:function(){var m=_glMatrix.mat4.create();return _glMatrix.mat4.perspective(m,2*Math.atan(this.height/2/this.altitude),this.width/this.height,.1,this.farZ),_glMatrix.mat4.translate(m,m,[0,0,-this.altitude]),_glMatrix.mat4.scale(m,m,[1,-1,1/this.height]),_glMatrix.mat4.rotateX(m,m,this.pitchRadians),_glMatrix.mat4.rotateZ(m,m,-this.bearingRadians),_glMatrix.mat4.translate(m,m,[-this.centerX,-this.centerY,0]),m}}]),Viewport}();exports["default"]=Viewport},479:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _class,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_autobindDecorator=__webpack_require__(46),_autobindDecorator2=_interopRequireDefault(_autobindDecorator),_luma=__webpack_require__(65),_lodash=__webpack_require__(741),_lodash2=_interopRequireDefault(_lodash),PROP_TYPES={id:_react.PropTypes.string,width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,pixelRatio:_react.PropTypes.number,viewport:_react.PropTypes.object.isRequired,camera:_react.PropTypes.instanceOf(_luma.Camera).isRequired,scene:_react.PropTypes.instanceOf(_luma.Scene),blending:_react.PropTypes.object,events:_react.PropTypes.object,gl:_react.PropTypes.object,debug:_react.PropTypes.bool,onRendererInitialized:_react.PropTypes.func.isRequired,onInitializationFailed:_react.PropTypes.func,onError:_react.PropTypes.func,onBeforeRenderFrame:_react.PropTypes.func,onAfterRenderFrame:_react.PropTypes.func,onBeforeRenderPickingScene:_react.PropTypes.func,onAfterRenderPickingScene:_react.PropTypes.func,onNeedRedraw:_react.PropTypes.func,onMouseMove:_react.PropTypes.func,onClick:_react.PropTypes.func},DEFAULT_PROPS={id:"webgl-canvas",scene:null,gl:null,debug:!1,onRendererInitialized:function(){},onInitializationFailed:function(error){return console.error(error)},onError:function(error){throw error},onBeforeRenderFrame:function(){},onAfterRenderFrame:function(){},onBeforeRenderPickingScene:function(){},onAfterRenderPickingScene:function(){},onNeedRedraw:function(){return!0},onMouseMove:function(){},onClick:function(){}},WebGLRenderer=(_class=function(_React$Component){function WebGLRenderer(props){_classCallCheck(this,WebGLRenderer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(WebGLRenderer).call(this,props));return _this.state={gl:null},_this}return _inherits(WebGLRenderer,_React$Component),_createClass(WebGLRenderer,null,[{key:"propTypes",get:function(){return PROP_TYPES}},{key:"defaultProps",get:function(){return DEFAULT_PROPS}}]),_createClass(WebGLRenderer,[{key:"componentDidMount",value:function(){var canvas=this.refs.overlay;this._initWebGL(canvas)}},{key:"_initWebGL",value:function(canvas){var debug=this.props.debug,gl=this.props.gl;if(!gl)try{gl=(0,_luma.createGLContext)({canvas:canvas,debug:debug,preserveDrawingBuffer:!0})}catch(error){return void this.props.onInitializationFailed(error)}var events=(0,_luma.addEvents)(canvas,{cacheSize:!1,cachePosition:!1,centerOrigin:!1,onClick:this._onClick,onMouseMove:(0,_lodash2["default"])(this._onMouseMove,100)});this.setState({gl:gl,events:events}),this._animationLoop(),this.props.onRendererInitialized({
gl:gl})}},{key:"_pick",value:function(x,y){var gl=this.state.gl,_props=this.props,camera=_props.camera,scene=_props.scene,pixelRatio=_props.pixelRatio,pickedModels=scene.pickModels(gl,{camera:camera,x:x*pixelRatio,y:y*pixelRatio});return pickedModels}},{key:"_onClick",value:function(event){var picked=this._pick(event.x,event.y);this.props.onClick(_extends({},event,{picked:picked}))}},{key:"_onMouseMove",value:function(event){var picked=this._pick(event.x,event.y);this.props.onMouseMove(_extends({},event,{picked:picked}))}},{key:"_renderFrame",value:function(){var _props2=this.props,_props2$viewport=_props2.viewport,x=_props2$viewport.x,y=_props2$viewport.y,width=_props2$viewport.width,height=_props2$viewport.height,_props2$blending=_props2.blending,enable=_props2$blending.enable,blendFunc=_props2$blending.blendFunc,blendEquation=_props2$blending.blendEquation,pixelRatio=_props2.pixelRatio,camera=_props2.camera,scene=_props2.scene,gl=this.state.gl;gl&&scene&&this.props.onNeedRedraw()&&(gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.viewport(x*pixelRatio,y*pixelRatio,width*pixelRatio,height*pixelRatio),enable?(gl.enable(gl.BLEND),gl.blendFunc.apply(gl,_toConsumableArray(blendFunc.map(function(s){return(0,_luma.glGet)(gl,s)}))),gl.blendEquation((0,_luma.glGet)(gl,blendEquation))):gl.disable(gl.BLEND),this.props.onBeforeRenderFrame(),scene.render({camera:camera}),this.props.onAfterRenderFrame())}},{key:"_animationLoop",value:function(){this._renderFrame(),_luma.Fx.requestAnimationFrame(this._animationLoop)}},{key:"render",value:function(){var _props3=this.props,id=_props3.id,width=_props3.width,height=_props3.height,pixelRatio=_props3.pixelRatio;return _react2["default"].createElement("canvas",{ref:"overlay",id:id,width:width*pixelRatio||1,height:height*pixelRatio||1,style:{width:width,height:height}})}}]),WebGLRenderer}(_react2["default"].Component),_applyDecoratedDescriptor(_class.prototype,"_onClick",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_onClick"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_onMouseMove",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_onMouseMove"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"_animationLoop",[_autobindDecorator2["default"]],Object.getOwnPropertyDescriptor(_class.prototype,"_animationLoop"),_class.prototype),_class);exports["default"]=WebGLRenderer},480:function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(461)},481:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}__webpack_require__(483);var _react=__webpack_require__(3),_react2=_interopRequireDefault(_react),_reactDom=__webpack_require__(880),_reactDom2=_interopRequireDefault(_reactDom),_redux=__webpack_require__(420),_reactRedux=__webpack_require__(134),_reduxThunk=__webpack_require__(997),_reduxThunk2=_interopRequireDefault(_reduxThunk),_actions=__webpack_require__(114),_reducers=__webpack_require__(482),_reducers2=_interopRequireDefault(_reducers),_reactRouter=__webpack_require__(382),_OkavangoContainer=__webpack_require__(458),_OkavangoContainer2=_interopRequireDefault(_OkavangoContainer),_MapPage=__webpack_require__(444),_MapPage2=_interopRequireDefault(_MapPage),_JournalPageContainer=__webpack_require__(456),_JournalPageContainer2=_interopRequireDefault(_JournalPageContainer),_DataPage=__webpack_require__(435),_DataPage2=_interopRequireDefault(_DataPage),_AboutPage=__webpack_require__(432),_AboutPage2=_interopRequireDefault(_AboutPage),_SharePage=__webpack_require__(451),_SharePage2=_interopRequireDefault(_SharePage);document.getElementById("root").remove();var store=(0,_redux.createStore)(_reducers2["default"],(0,_redux.applyMiddleware)(_reduxThunk2["default"])),routes=_react2["default"].createElement(_reactRouter.Route,{path:"/",component:_OkavangoContainer2["default"]},_react2["default"].createElement(_reactRouter.IndexRoute,{component:_MapPage2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"map",component:_MapPage2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"journal",component:_JournalPageContainer2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"data",component:_DataPage2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"about",component:_AboutPage2["default"]}),_react2["default"].createElement(_reactRouter.Route,{path:"share",component:_SharePage2["default"]})),render=function(){_reactDom2["default"].render(_react2["default"].createElement(_reactRedux.Provider,{store:store},_react2["default"].createElement(_reactRouter.Router,{history:_reactRouter.browserHistory,routes:routes})),document.getElementById("okavango"))};store.subscribe(render),store.dispatch((0,_actions.fetchExpeditions)()),window.onclick=function(event){if(!event.target.matches(".dropbtn")){var i,dropdowns=document.getElementsByClassName("dropdown-content");for(i=0;i<dropdowns.length;i++){var openDropdown=dropdowns[i];openDropdown.classList.contains("show")&&openDropdown.classList.remove("show")}}}},482:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj["default"]=obj,newObj}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_actions=__webpack_require__(114),actions=_interopRequireWildcard(_actions),_d=__webpack_require__(90),d3=_interopRequireWildcard(_d),_randomcolor=__webpack_require__(879),_randomcolor2=_interopRequireDefault(_randomcolor),okavangoReducer=function(){var expeditions,features,id,expeditionID,expedition,days,timeRange,postsByDay,start,end,startDay,endDay,latestDate,latestExpedition,selectedExpedition,members,featuresByMember,featuresByDay,ambitsByTile,dateRange,i,tileResolution,coordinatesToTile,d,tileRange,featuresByTile,tileResolution,coordinatesToTile,k,feature,state=arguments.length<=0||void 0===arguments[0]?{mapStateNeedsUpdate:!1,animate:!1,isFetching:!1,selectedExpedition:null,expeditions:{},speciesColors:{},contentActive:!("/"===location.pathname||"/map"===location.pathname),initialPage:location.pathname}:arguments[0],action=arguments[1],_ret=function(){switch(action.type){case actions.ENABLE_CONTENT:return{v:_extends({},state,{contentActive:!0})};case actions.RECEIVE_POSTS:for(expeditionID=action.expeditionID,expedition=state.expeditions[expeditionID],timeRange=action.timeRange,postsByDay={},start=new Date(timeRange[0]),end=new Date(timeRange[1]),startDay=Math.floor((start.getTime()-expedition.start.getTime())/864e5),endDay=Math.floor((end.getTime()-expedition.start.getTime())/864e5),i=startDay;i<=endDay;i++)postsByDay[i]={};return features={},action.data.forEach(function(f){var id=f.id,flag=!0;f.geometry||(flag=!1),"image"===f.properties.FeatureType&&"ricoh theta 360"===f.properties.Model.toLowerCase()&&(flag=!1),flag&&(features[id]=featureReducer(expedition.features[id],action,f))}),Object.keys(features).forEach(function(id){var feature=features[id],day=Math.floor((new Date(feature.properties.DateTime).getTime()-expedition.start.getTime())/864e5);postsByDay[day]||(postsByDay[day]={}),postsByDay[day][id]=feature}),Object.keys(postsByDay).forEach(function(k){postsByDay[k]=Object.assign({},expedition.postsByDay[k],postsByDay[k])}),{v:Object.assign({},state,{mapStateNeedsUpdate:!1,expeditions:Object.assign({},state.expeditions,_defineProperty({},expeditionID,Object.assign({},expedition,{features:Object.assign({},expedition.features,features),postsByDay:Object.assign({},expedition.postsByDay,postsByDay)})))})};case actions.FETCH_POSTS_BY_DAY:return id=action.expeditionID,{v:Object.assign({},state,{expeditions:Object.assign({},state.expeditions,_defineProperty({},id,expeditionReducer(state.expeditions[id],action)))})};case actions.RECEIVE_TOTAL_SIGHTINGS:return id=action.id,{v:Object.assign({},state,{expeditions:Object.assign({},state.expeditions,_defineProperty({},id,Object.assign({},state.expeditions[action.id],{totalSightings:action.data.results})))})};case actions.COMPLETE_DAYS:return id=action.expeditionID,{v:Object.assign({},state,{mapStateNeedsUpdate:!1,expeditions:Object.assign({},state.expeditions,_defineProperty({},id,expeditionReducer(state.expeditions[id],action)))})};case actions.SHOW_LOADING_WHEEL:return{v:Object.assign({},state,{mapStateNeedsUpdate:!1,isFetching:!0})};case actions.HIDE_LOADING_WHEEL:return{v:Object.assign({},state,{mapStateNeedsUpdate:!0,isFetching:!1})};case actions.START:return{v:Object.assign({},state,{mapStateNeedsUpdate:!0,animate:!0})};case actions.UPDATE_TIME:return expeditionID=action.expeditionID,{v:Object.assign({},state,{mapStateNeedsUpdate:action.updateMapState,expeditions:Object.assign({},state.expeditions,_defineProperty({},expeditionID,expeditionReducer(state.expeditions[expeditionID],action)))})};case actions.UPDATE_MAP:return expeditionID=action.expeditionID,{v:Object.assign({},state,{mapStateNeedsUpdate:!0,expeditions:Object.assign({},state.expeditions,_defineProperty({},expeditionID,expeditionReducer(state.expeditions[expeditionID],action)))})};case actions.RECEIVE_EXPEDITIONS:return expeditions={},latestDate=new Date(0),Object.keys(action.data.results).forEach(function(id){var e=action.data.results[id];expeditions[id]=expeditionReducer(state.expeditions[id],action,e),expeditions[id].start.getTime()+864e5*expeditions[id].dayCount>latestDate.getTime()&&(latestDate=new Date(expeditions[id].start.getTime()+864e5*expeditions[id].dayCount),latestExpedition=id)}),{v:Object.assign({},state,{expeditions:Object.assign({},state.expeditions,expeditions),isFetching:!1,selectedExpedition:latestExpedition})};case actions.SET_EXPEDITION:return selectedExpedition=action.id,{v:Object.assign({},state,{mapStateNeedsUpdate:!0,selectedExpedition:selectedExpedition})};case actions.SET_CONTROL:return id=state.selectedExpedition,expeditions=_defineProperty({},id,expeditionReducer(state.expeditions[id],action)),{v:Object.assign({},state,{mapStateNeedsUpdate:"zoom"===action.target,expeditions:Object.assign({},state.expeditions,expeditions)})};case actions.RECEIVE_DAY:for(expeditionID=action.expeditionID,expedition=state.expeditions[expeditionID],members=_extends({},expedition.members),featuresByMember={},featuresByDay={},ambitsByTile={},dateRange=action.dateRange.map(function(d){return Math.floor((new Date(d).getTime()-expedition.start.getTime())/864e5)}),i=dateRange[0];i<=dateRange[1];i++)featuresByDay[i]={};features={},action.data.forEach(function(f){var id=f.id;"RiverMain"===f.properties.Team&&("ambit_geo"===f.properties.FeatureType&&"Steve"!==f.properties.Member&&"GB"!==f.properties.Member&&"Jer"!==f.properties.Member&&"Shah"!==f.properties.Member||(features[id]=featureReducer(expedition.features[id],action,f),"ambit_geo"===f.properties.FeatureType&&(members[f.properties.Member]||(members[f.properties.Member]={color:expedition.memberColors[d3.values(members).length%expedition.memberColors.length]}))))}),tileResolution=Math.floor(111*(expedition.geoBounds[2]-expedition.geoBounds[0])/10),coordinatesToTile=function(coordinates,geoBounds){var x=Math.floor(111*(coordinates[0]-geoBounds[0])/10),y=Math.floor(111*(coordinates[1]-geoBounds[3])/10);return{x:x,y:y}},Object.keys(features).forEach(function(id){var feature=features[id],day=Math.floor((new Date(feature.properties.DateTime).getTime()-expedition.start.getTime())/864e5),type=feature.properties.FeatureType;if(featuresByDay[day]||(featuresByDay[day]={}),featuresByDay[day][type]||(featuresByDay[day][type]={}),featuresByDay[day][type][id]=feature,"ambit_geo"===feature.properties.FeatureType){var memberID=feature.properties.Member;members[memberID]||(members[memberID]={name:memberID,color:expedition.memberColors[d3.values(members).length%expedition.memberColors.length]});var dayID=Math.floor((new Date(feature.properties.DateTime).getTime()-expedition.start.getTime())/864e5);featuresByMember[memberID]||(featuresByMember[memberID]={}),featuresByMember[memberID][dayID]||(featuresByMember[memberID][dayID]={}),featuresByMember[memberID][dayID][id]=feature;var tileCoordinates=coordinatesToTile(feature.geometry.coordinates,expedition.geoBounds),tileID=tileCoordinates.x+tileCoordinates.y*tileResolution;ambitsByTile[tileID]||(ambitsByTile[tileID]={}),ambitsByTile[tileID][id]=feature}});var extendFeatures=function(bucket){if(d3.values(bucket).length>0){var timeRange=[new Date,new Date(0)],featureRange=[];d3.values(bucket).forEach(function(f){var dateTime=new Date(f.properties.DateTime);timeRange[0].getTime()>dateTime.getTime()&&(timeRange[0]=dateTime,featureRange[0]=f),timeRange[1].getTime()<dateTime.getTime()&&(timeRange[1]=dateTime,featureRange[1]=f)});var start=new Date(timeRange[0].getTime()-timeRange[0].getTime()%864e5),end=new Date(start.getTime()+864e5);id=Date.now()+Math.floor(1e4*Math.random())/1e4,bucket[id]=Object.assign({},featureRange[0]),bucket[id].properties=Object.assign({},bucket[id].properties,{DateTime:start.toString()}),id=Date.now()+Math.floor(1e4*Math.random())/1e4,bucket[id]=Object.assign({},featureRange[1]),bucket[id].properties=Object.assign({},bucket[id].properties,{DateTime:end.toString()})}};Object.keys(featuresByDay).forEach(function(d){featuresByDay[d]=Object.assign({},expedition.featuresByDay[d],featuresByDay[d]),extendFeatures(featuresByDay[d].beacon)}),Object.keys(featuresByMember).forEach(function(m){Object.keys(featuresByMember[m]).forEach(function(d){extendFeatures(featuresByMember[m][d])})}),featuresByDay=Object.assign({},expedition.featuresByDay,featuresByDay),days=Object.assign({},featuresByDay);for(d in days)days[d]=dayReducer(expedition.days[d],action,featuresByDay[d]);return Object.keys(featuresByMember).forEach(function(k){featuresByMember[k]=Object.assign({},expedition.featuresByMember[k],featuresByMember[k])}),Object.keys(ambitsByTile).forEach(function(k){ambitsByTile[k]=Object.assign({},expedition.ambitsByTile[k],ambitsByTile[k])}),{v:Object.assign({},state,{mapStateNeedsUpdate:!1,expeditions:Object.assign({},state.expeditions,_defineProperty({},expeditionID,Object.assign({},expedition,{days:Object.assign({},expedition.days,days),featuresByDay:featuresByDay,featuresByMember:Object.assign({},expedition.featuresByMember,featuresByMember),ambitsByTile:Object.assign({},expedition.ambitsByTile,ambitsByTile),members:members})))})};case actions.RECEIVE_FEATURES:expeditionID=action.expeditionID,expedition=state.expeditions[expeditionID],tileRange=action.tileRange,featuresByTile={},tileRange.forEach(function(t,i){featuresByTile[t]={}});var rgbToString=function(rgb){return rgb.slice(4).slice(0,-1).split(",").map(function(c){return parseInt(c)})};features={},action.data.forEach(function(f){var id=f.id;if("RiverMain"===f.properties.Team){var flag=!0;if("sighting"===f.properties.FeatureType)if(f.properties.Taxonomy){var taxClass=f.properties.Taxonomy.Class;state.speciesColors[taxClass]||(state.speciesColors[taxClass]=rgbToString((0,_randomcolor2["default"])({luminosity:"light",format:"rgb"}))),f.properties.color=state.speciesColors[taxClass]}else f.properties.color=rgbToString("rgb(180,180,180)");"tweet"===f.properties.FeatureType&&f.properties.Text&&"@"===f.properties.Text[0]&&(flag=!1),"image"===f.properties.FeatureType&&"ricoh theta 360"===f.properties.Model.toLowerCase()&&(flag=!1),flag&&(features[id]=featureReducer(expedition.features[id],action,f))}}),tileResolution=Math.floor(111*(expedition.geoBounds[2]-expedition.geoBounds[0])/10),coordinatesToTile=function(coordinates,geoBounds){var x=Math.floor(111*(coordinates[0]-geoBounds[0])/10),y=Math.floor(111*(coordinates[1]-geoBounds[3])/10);return{x:x,y:y}},Object.keys(features).forEach(function(id){var feature=features[id],tileCoordinates=coordinatesToTile(feature.geometry.coordinates,expedition.geoBounds),tileID=tileCoordinates.x+tileCoordinates.y*tileResolution;featuresByTile[tileID]||(featuresByTile[tileID]={}),featuresByTile[tileID][id]=feature}),Object.keys(featuresByTile).forEach(function(k){featuresByTile[k]=Object.assign({},expedition.featuresByTile[k],featuresByTile[k])});for(k in features)feature=features[k],"sighting"===feature.properties.FeatureType&&delete features[k];return{v:Object.assign({},state,{mapStateNeedsUpdate:!1,expeditions:Object.assign({},state.expeditions,_defineProperty({},expeditionID,Object.assign({},expedition,{features:Object.assign({},expedition.features,features),featuresByTile:Object.assign({},expedition.featuresByTile,featuresByTile)})))})};case actions.SELECT_FEATURE:break;case actions.UNSELECT_FEATURE:break;default:return{v:state}}}();return"object"===("undefined"==typeof _ret?"undefined":_typeof(_ret))?_ret.v:state},expeditionReducer=function(){var i,state=arguments.length<=0||void 0===arguments[0]?{name:"",playback:"forward",layout:"rows",initialZoom:4,targetZoom:15,zoom:15,isFetching:!1,geoBounds:[-8,-21.5,25.5,12],tileSize:10,start:new Date,end:new Date(0),currentDate:new Date,dayCount:0,days:[],features:{},featuresByTile:{},ambitsByTile:{},featuresByDay:{},postsByDay:{},featuresByMember:{},mainFocus:"Explorers",secondaryFocus:"Steve",coordinates:[0,0],currentPosts:[],currentSightings:[],currentAmbits:[],totalSightings:[],memberColors:["rgba(253, 191, 111, 1)","rgba(166, 206, 227, 1)","rgba(178, 223, 138, 1)","rgba(251, 154, 153, 1)","rgba(202, 178, 214, 1)","rgba(252, 234, 151, 1)","rgba(180, 240, 209, 1)","rgba(191, 191, 255, 1)","rgba(255, 171, 213, 1)"],members:{},currentMembers:[]}:arguments[0],action=arguments[1],data=arguments[2];switch(action.type){case actions.FETCH_POSTS_BY_DAY:var postsByDay=[];return action.daysToFetch.forEach(function(d){postsByDay[d]="loading"}),Object.assign({},state,{postsByDay:Object.assign({},state.postsByDay,postsByDay)});case actions.COMPLETE_DAYS:var days=Object.assign({},state.days);for(i=0;i<state.dayCount;i++)if(days[i]&&!days[i].incomplete){days[-1]=Object.assign({},days[i]);break}for(i=state.dayCount;i>=0;i--)if(days[i]&&!days[i].incomplete){days[state.dayCount]=Object.assign({},days[i]);break}var incompleteRange=[-1,-1],completedDays=[];for(i=0;i<state.dayCount;i++){var day=days[i];if(day?(day.incomplete&&days[i-1]&&!days[i-1].incomplete&&(incompleteRange[0]=i,incompleteRange[1]=-1),day.incomplete&&days[i+1]&&!days[i+1].incomplete&&(incompleteRange[1]=i)):incompleteRange=[-1,-1],incompleteRange[0]>-1&&incompleteRange[1]>-1){for(var fillingDays=[days[+incompleteRange[0]-1],days[+incompleteRange[1]+1]],fillingBeacons=[d3.values(fillingDays[0].beacons).slice(0).sort(function(a,b){return new Date(b.properties.DateTime).getTime()-new Date(a.properties.DateTime).getTime()})[0],d3.values(fillingDays[1].beacons).slice(0).sort(function(a,b){return new Date(a.properties.DateTime).getTime()-new Date(b.properties.DateTime).getTime()})[0]],l2=Math.ceil((incompleteRange[1]-incompleteRange[0]+1)/2),j=0;j<l2;j++)for(var dayIndex=[+incompleteRange[0]+j,+incompleteRange[1]-j],k=0;k<2;k++)for(var l=0;l<2;l++)if(0===k||days[dayIndex[0]]!==days[dayIndex[1]]||0===l){var dayID=dayIndex[k];day=days[dayID];var date=new Date(state.start.getTime()+864e5*(dayID+(k===l?0:1))),beaconID=Date.now()+Math.floor(1e4*Math.random())/1e4;day.beacons[beaconID]=Object.assign({},fillingBeacons[k]),day.beacons[beaconID].properties=Object.assign({},day.beacons[beaconID].properties,{DateTime:date}),day.incomplete=!1,completedDays.indexOf(dayID)===-1&&completedDays.push(dayID)}incompleteRange=[-1,-1]}}return delete days[-1],delete days[state.dayCount],Object.assign({},state,{days:days});case actions.UPDATE_TIME:return Object.assign({},state,{currentDate:action.currentDate});case actions.UPDATE_MAP:action.tileRange.forEach(function(t){state.featuresByTile[t]||(state.featuresByTile[t]={})});var currentSightings=[],currentPosts=[],currentDays=[],currentAmbits={},currentMembers=[],allAmbits=[];action.tilesInView.forEach(function(t){var features={};if(d3.values(state.featuresByTile[t]).forEach(function(f){features[f.properties.FeatureType]||(features[f.properties.FeatureType]=[]),features[f.properties.FeatureType].push(f);var day=Math.floor((new Date(f.properties.DateTime).getTime()-state.start.getTime())/864e5);currentDays.indexOf(day)===-1&&currentDays.push(day)}),d3.values(state.ambitsByTile[t]).forEach(function(f){var day=Math.floor((new Date(f.properties.DateTime).getTime()-state.start.getTime())/864e5);currentDays.indexOf(day)===-1&&currentDays.push(day)}),features.sighting){var sightings=features.sighting.map(function(f){return{position:{x:f.geometry.coordinates[0],y:f.geometry.coordinates[1],z:0},radius:f.properties.radius,color:f.properties.color,type:f.properties.FeatureType}});currentSightings=currentSightings.concat(sightings)}var allPosts=[];if(features.tweet&&(allPosts=allPosts.concat(features.tweet)),features.audio&&(allPosts=allPosts.concat(features.audio)),features.blog&&(allPosts=allPosts.concat(features.blog)),features.image&&(allPosts=allPosts.concat(features.image)),allPosts){var posts=allPosts.map(function(f){return{position:[f.geometry.coordinates[0],f.geometry.coordinates[1]],type:f.properties.FeatureType,id:f.id,properties:f.properties}});currentPosts=currentPosts.concat(posts)}});var paddingDays=[];return currentDays.forEach(function(d){var flag=!1;for(i=d-1;i<=d+1;i++)currentDays.indexOf(i)===-1&&paddingDays.indexOf(i)===-1&&(paddingDays.push(i),flag=!0);flag&&actions.fetchDay(new Date(state.start.getTime()+864e5*d))}),currentDays=currentDays.concat(paddingDays),currentDays=currentDays.sort(function(a,b){return a-b}).forEach(function(d){state.featuresByDay[d]&&(allAmbits=allAmbits.concat(d3.values(state.featuresByDay[d].ambit_geo)))}),allAmbits.sort(function(a,b){return new Date(a.properties.DateTime).getTime()-new Date(b.properties.DateTime).getTime()}).forEach(function(f){var memberID=f.properties.Member;currentAmbits[memberID]||(currentAmbits[memberID]={color:state.members[memberID].color,coordinates:[],dates:[]}),currentMembers[memberID]||(currentMembers[memberID]={}),currentAmbits[memberID].coordinates.push(f.geometry.coordinates),currentAmbits[memberID].dates.push(f.properties.DateTime)}),currentAmbits=d3.values(currentAmbits),Object.assign({},state,{currentSightings:currentSightings,currentAmbits:currentAmbits,currentMembers:currentMembers,currentPosts:currentPosts,currentDate:action.currentDate,coordinates:action.coordinates,zoom:action.zoom});case actions.RECEIVE_EXPEDITIONS:var dayCount=data.Days+1,start=new Date(new Date(data.StartDate).getTime()+72e5),end=new Date(start.getTime()+864e5*dayCount),currentDate=new Date(end.getTime()-1728e5),name=data.Name,geoBounds=data.GeoBounds;return Object.assign({},state,{name:name,start:start,currentDate:currentDate,end:end,dayCount:dayCount,geoBounds:geoBounds});case actions.SET_CONTROL:return"zoom"===action.target&&("increment"===action.mode&&(action.mode=Math.max(1,Math.min(15,state.zoom+1))),"decrement"===action.mode&&(action.mode=Math.max(1,Math.min(15,state.zoom-1)))),Object.assign({},state,_defineProperty({},action.target,action.mode))}return state},dayReducer=function(){var start,end,state=arguments.length<=0||void 0===arguments[0]?{isFetching:!1,start:new Date,end:new Date(0),beacons:{},ambits:{},incomplete:!0}:arguments[0],action=arguments[1],features=arguments[2];switch(action.type){case actions.RECEIVE_DAY:if(start=new Date,end=new Date(0),!features.beacon)break;var incomplete=0===Object.keys(features.beacon).length;return Object.keys(features.beacon).forEach(function(k){var f=features.beacon[k],d=new Date(f.properties.DateTime);d.getTime()<start.getTime()&&(start=d),d.getTime()>end.getTime()&&(end=d)}),Object.assign({},state,{isFetching:!1,start:start,end:end,beacons:Object.assign({},state.beacons,features.beacon),ambits:Object.assign({},state.ambits,features.ambit),incomplete:incomplete})}return state},featureReducer=function(){var state=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],action=arguments[1],feature=arguments[2];switch(action.type){case actions.RECEIVE_POSTS:return feature.properties.scatter=[75e-5*(2*Math.random()-1),75e-5*(2*Math.random()-1)],Object.assign({},state,feature);case actions.RECEIVE_DAY:return Object.assign({},state,feature);case actions.RECEIVE_FEATURES:return feature.properties.scatter=[75e-5*(2*Math.random()-1),75e-5*(2*Math.random()-1)],"sighting"===feature.properties.FeatureType&&(feature.properties.radius=2+2*Math.sqrt(feature.properties.Count)),Object.assign({},state,feature)}return state};exports["default"]=okavangoReducer},1039:function(module,exports){},1040:1039,1041:1039});